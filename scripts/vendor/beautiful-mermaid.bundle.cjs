var Z7=Object.create;var{getPrototypeOf:U7,defineProperty:f0,getOwnPropertyNames:M6,getOwnPropertyDescriptor:V7}=Object,R6=Object.prototype.hasOwnProperty;var z7=($,J,K)=>{K=$!=null?Z7(U7($)):{};let Q=J||!$||!$.__esModule?f0(K,"default",{value:$,enumerable:!0}):K;for(let Z of M6($))if(!R6.call(Q,Z))f0(Q,Z,{get:()=>$[Z],enumerable:!0});return Q},W6=new WeakMap,B7=($)=>{var J=W6.get($),K;if(J)return J;if(J=f0({},"__esModule",{value:!0}),$&&typeof $==="object"||typeof $==="function")M6($).map((Q)=>!R6.call(J,Q)&&f0(J,Q,{get:()=>$[Q],enumerable:!(K=V7($,Q))||K.enumerable}));return W6.set($,J),J},j7=($,J)=>()=>(J||$((J={exports:{}}).exports,J),J.exports);var _7=($,J)=>{for(var K in J)f0($,K,{get:J[K],enumerable:!0,configurable:!0,set:(Q)=>J[K]=()=>Q})};var Y6=j7((q6,Q6)=>{(function($){if(typeof q6==="object"&&typeof Q6<"u")Q6.exports=$();else if(typeof define==="function"&&define.amd)define([],$);else{var J;if(typeof window<"u")J=window;else if(typeof global<"u")J=global;else if(typeof self<"u")J=self;else J=this;J.dagre=$()}})(function(){var $,J,K;return function(){function Q(Z,z,B){function U(F,H){if(!z[F]){if(!Z[F]){var V=require;if(!H&&V)return V(F,!0);if(j)return j(F,!0);var P=Error("Cannot find module '"+F+"'");throw P.code="MODULE_NOT_FOUND",P}var W=z[F]={exports:{}};Z[F][0].call(W.exports,function(G){var R=Z[F][1][G];return U(R||G)},W,W.exports,Q,Z,z,B)}return z[F].exports}for(var j=require,_=0;_<B.length;_++)U(B[_]);return U}return Q}()({1:[function(Q,Z,z){Z.exports={graphlib:Q("@dagrejs/graphlib"),layout:Q("./lib/layout"),debug:Q("./lib/debug"),util:{time:Q("./lib/util").time,notime:Q("./lib/util").notime},version:Q("./lib/version")}},{"./lib/debug":6,"./lib/layout":8,"./lib/util":27,"./lib/version":28,"@dagrejs/graphlib":29}],2:[function(Q,Z,z){let B=Q("./greedy-fas"),U=Q("./util").uniqueId;Z.exports={run:j,undo:F};function j(H){(H.graph().acyclicer==="greedy"?B(H,P(H)):_(H)).forEach((W)=>{let G=H.edge(W);H.removeEdge(W),G.forwardName=W.name,G.reversed=!0,H.setEdge(W.w,W.v,G,U("rev"))});function P(W){return(G)=>{return W.edge(G).weight}}}function _(H){let V=[],P={},W={};function G(R){if(Object.hasOwn(W,R))return;W[R]=!0,P[R]=!0,H.outEdges(R).forEach((M)=>{if(Object.hasOwn(P,M.w))V.push(M);else G(M.w)}),delete P[R]}return H.nodes().forEach(G),V}function F(H){H.edges().forEach((V)=>{let P=H.edge(V);if(P.reversed){H.removeEdge(V);let W=P.forwardName;delete P.reversed,delete P.forwardName,H.setEdge(V.w,V.v,P,W)}})}},{"./greedy-fas":7,"./util":27}],3:[function(Q,Z,z){let B=Q("./util");Z.exports=U;function U(_){function F(H){let V=_.children(H),P=_.node(H);if(V.length)V.forEach(F);if(Object.hasOwn(P,"minRank")){P.borderLeft=[],P.borderRight=[];for(let W=P.minRank,G=P.maxRank+1;W<G;++W)j(_,"borderLeft","_bl",H,P,W),j(_,"borderRight","_br",H,P,W)}}_.children().forEach(F)}function j(_,F,H,V,P,W){let G={width:0,height:0,rank:W,borderType:F},R=P[F][W-1],M=B.addDummyNode(_,"border",G,H);if(P[F][W]=M,_.setParent(M,V),R)_.setEdge(R,M,{weight:1})}},{"./util":27}],4:[function(Q,Z,z){Z.exports={adjust:B,undo:U};function B(W){let G=W.graph().rankdir.toLowerCase();if(G==="lr"||G==="rl")j(W)}function U(W){let G=W.graph().rankdir.toLowerCase();if(G==="bt"||G==="rl")F(W);if(G==="lr"||G==="rl")V(W),j(W)}function j(W){W.nodes().forEach((G)=>_(W.node(G))),W.edges().forEach((G)=>_(W.edge(G)))}function _(W){let G=W.width;W.width=W.height,W.height=G}function F(W){W.nodes().forEach((G)=>H(W.node(G))),W.edges().forEach((G)=>{let R=W.edge(G);if(R.points.forEach(H),Object.hasOwn(R,"y"))H(R)})}function H(W){W.y=-W.y}function V(W){W.nodes().forEach((G)=>P(W.node(G))),W.edges().forEach((G)=>{let R=W.edge(G);if(R.points.forEach(P),Object.hasOwn(R,"x"))P(R)})}function P(W){let G=W.x;W.x=W.y,W.y=G}},{}],5:[function(Q,Z,z){class B{constructor(){let _={};_._next=_._prev=_,this._sentinel=_}dequeue(){let _=this._sentinel,F=_._prev;if(F!==_)return U(F),F}enqueue(_){let F=this._sentinel;if(_._prev&&_._next)U(_);_._next=F._next,F._next._prev=_,F._next=_,_._prev=F}toString(){let _=[],F=this._sentinel,H=F._prev;while(H!==F)_.push(JSON.stringify(H,j)),H=H._prev;return"["+_.join(", ")+"]"}}function U(_){_._prev._next=_._next,_._next._prev=_._prev,delete _._next,delete _._prev}function j(_,F){if(_!=="_next"&&_!=="_prev")return F}Z.exports=B},{}],6:[function(Q,Z,z){let B=Q("./util"),U=Q("@dagrejs/graphlib").Graph;Z.exports={debugOrdering:j};function j(_){let F=B.buildLayerMatrix(_),H=new U({compound:!0,multigraph:!0}).setGraph({});return _.nodes().forEach((V)=>{H.setNode(V,{label:V}),H.setParent(V,"layer"+_.node(V).rank)}),_.edges().forEach((V)=>H.setEdge(V.v,V.w,{},V.name)),F.forEach((V,P)=>{let W="layer"+P;H.setNode(W,{rank:"same"}),V.reduce((G,R)=>{return H.setEdge(G,R,{style:"invis"}),R})}),H}},{"./util":27,"@dagrejs/graphlib":29}],7:[function(Q,Z,z){let B=Q("@dagrejs/graphlib").Graph,U=Q("./data/list");Z.exports=_;let j=()=>1;function _(G,R){if(G.nodeCount()<=1)return[];let M=V(G,R||j);return F(M.graph,M.buckets,M.zeroIdx).flatMap((D)=>G.outEdges(D.v,D.w))}function F(G,R,M){let q=[],D=R[R.length-1],I=R[0],x;while(G.nodeCount()){while(x=I.dequeue())H(G,R,M,x);while(x=D.dequeue())H(G,R,M,x);if(G.nodeCount()){for(let Y=R.length-2;Y>0;--Y)if(x=R[Y].dequeue(),x){q=q.concat(H(G,R,M,x,!0));break}}}return q}function H(G,R,M,q,D){let I=D?[]:void 0;return G.inEdges(q.v).forEach((x)=>{let Y=G.edge(x),A=G.node(x.v);if(D)I.push({v:x.v,w:x.w});A.out-=Y,P(R,M,A)}),G.outEdges(q.v).forEach((x)=>{let Y=G.edge(x),A=x.w,O=G.node(A);O.in-=Y,P(R,M,O)}),G.removeNode(q.v),I}function V(G,R){let M=new B,q=0,D=0;G.nodes().forEach((Y)=>{M.setNode(Y,{v:Y,in:0,out:0})}),G.edges().forEach((Y)=>{let A=M.edge(Y.v,Y.w)||0,O=R(Y),k=A+O;M.setEdge(Y.v,Y.w,k),D=Math.max(D,M.node(Y.v).out+=O),q=Math.max(q,M.node(Y.w).in+=O)});let I=W(D+q+3).map(()=>new U),x=q+1;return M.nodes().forEach((Y)=>{P(I,x,M.node(Y))}),{graph:M,buckets:I,zeroIdx:x}}function P(G,R,M){if(!M.out)G[0].enqueue(M);else if(!M.in)G[G.length-1].enqueue(M);else G[M.out-M.in+R].enqueue(M)}function W(G){let R=[];for(let M=0;M<G;M++)R.push(M);return R}},{"./data/list":5,"@dagrejs/graphlib":29}],8:[function(Q,Z,z){let B=Q("./acyclic"),U=Q("./normalize"),j=Q("./rank"),_=Q("./util").normalizeRanks,F=Q("./parent-dummy-chains"),H=Q("./util").removeEmptyRanks,V=Q("./nesting-graph"),P=Q("./add-border-segments"),W=Q("./coordinate-system"),G=Q("./order"),R=Q("./position"),M=Q("./util"),q=Q("@dagrejs/graphlib").Graph;Z.exports=D;function D(T,N){let y=N&&N.debugTiming?M.time:M.notime;y("layout",()=>{let g=y("  buildLayoutGraph",()=>X(T));y("  runLayout",()=>I(g,y,N)),y("  updateInputGraph",()=>x(T,g))})}function I(T,N,y){N("    makeSpaceForEdgeLabels",()=>C(T)),N("    removeSelfEdges",()=>p(T)),N("    acyclic",()=>B.run(T)),N("    nestingGraph.run",()=>V.run(T)),N("    rank",()=>j(M.asNonCompoundGraph(T))),N("    injectEdgeLabelProxies",()=>w(T)),N("    removeEmptyRanks",()=>H(T)),N("    nestingGraph.cleanup",()=>V.cleanup(T)),N("    normalizeRanks",()=>_(T)),N("    assignRankMinMax",()=>S(T)),N("    removeEdgeLabelProxies",()=>L(T)),N("    normalize.run",()=>U.run(T)),N("    parentDummyChains",()=>F(T)),N("    addBorderSegments",()=>P(T)),N("    order",()=>G(T,y)),N("    insertSelfEdges",()=>h(T)),N("    adjustCoordinateSystem",()=>W.adjust(T)),N("    position",()=>R(T)),N("    positionSelfEdges",()=>m(T)),N("    removeBorderNodes",()=>l(T)),N("    normalize.undo",()=>U.undo(T)),N("    fixupEdgeLabelCoords",()=>E(T)),N("    undoCoordinateSystem",()=>W.undo(T)),N("    translateGraph",()=>c(T)),N("    assignNodeIntersects",()=>s(T)),N("    reversePoints",()=>d(T)),N("    acyclic.undo",()=>B.undo(T))}function x(T,N){T.nodes().forEach((y)=>{let g=T.node(y),a=N.node(y);if(g){if(g.x=a.x,g.y=a.y,g.rank=a.rank,N.children(y).length)g.width=a.width,g.height=a.height}}),T.edges().forEach((y)=>{let g=T.edge(y),a=N.edge(y);if(g.points=a.points,Object.hasOwn(a,"x"))g.x=a.x,g.y=a.y}),T.graph().width=N.graph().width,T.graph().height=N.graph().height}let Y=["nodesep","edgesep","ranksep","marginx","marginy"],A={ranksep:50,edgesep:20,nodesep:50,rankdir:"tb"},O=["acyclicer","ranker","rankdir","align"],k=["width","height","rank"],v={width:0,height:0},u=["minlen","weight","width","height","labeloffset"],b={minlen:1,weight:1,width:0,height:0,labeloffset:10,labelpos:"r"},f=["labelpos"];function X(T){let N=new q({multigraph:!0,compound:!0}),y=o(T.graph());return N.setGraph(Object.assign({},A,n(y,Y),M.pick(y,O))),T.nodes().forEach((g)=>{let a=o(T.node(g)),e=n(a,k);Object.keys(v).forEach((t)=>{if(e[t]===void 0)e[t]=v[t]}),N.setNode(g,e),N.setParent(g,T.parent(g))}),T.edges().forEach((g)=>{let a=o(T.edge(g));N.setEdge(g,Object.assign({},b,n(a,u),M.pick(a,f)))}),N}function C(T){let N=T.graph();N.ranksep/=2,T.edges().forEach((y)=>{let g=T.edge(y);if(g.minlen*=2,g.labelpos.toLowerCase()!=="c")if(N.rankdir==="TB"||N.rankdir==="BT")g.width+=g.labeloffset;else g.height+=g.labeloffset})}function w(T){T.edges().forEach((N)=>{let y=T.edge(N);if(y.width&&y.height){let g=T.node(N.v),e={rank:(T.node(N.w).rank-g.rank)/2+g.rank,e:N};M.addDummyNode(T,"edge-proxy",e,"_ep")}})}function S(T){let N=0;T.nodes().forEach((y)=>{let g=T.node(y);if(g.borderTop)g.minRank=T.node(g.borderTop).rank,g.maxRank=T.node(g.borderBottom).rank,N=Math.max(N,g.maxRank)}),T.graph().maxRank=N}function L(T){T.nodes().forEach((N)=>{let y=T.node(N);if(y.dummy==="edge-proxy")T.edge(y.e).labelRank=y.rank,T.removeNode(N)})}function c(T){let N=Number.POSITIVE_INFINITY,y=0,g=Number.POSITIVE_INFINITY,a=0,e=T.graph(),t=e.marginx||0,z0=e.marginy||0;function G0(H0){let{x:F0,y:w0,width:P6,height:H6}=H0;N=Math.min(N,F0-P6/2),y=Math.max(y,F0+P6/2),g=Math.min(g,w0-H6/2),a=Math.max(a,w0+H6/2)}T.nodes().forEach((H0)=>G0(T.node(H0))),T.edges().forEach((H0)=>{let F0=T.edge(H0);if(Object.hasOwn(F0,"x"))G0(F0)}),N-=t,g-=z0,T.nodes().forEach((H0)=>{let F0=T.node(H0);F0.x-=N,F0.y-=g}),T.edges().forEach((H0)=>{let F0=T.edge(H0);if(F0.points.forEach((w0)=>{w0.x-=N,w0.y-=g}),Object.hasOwn(F0,"x"))F0.x-=N;if(Object.hasOwn(F0,"y"))F0.y-=g}),e.width=y-N+t,e.height=a-g+z0}function s(T){T.edges().forEach((N)=>{let y=T.edge(N),g=T.node(N.v),a=T.node(N.w),e,t;if(!y.points)y.points=[],e=a,t=g;else e=y.points[0],t=y.points[y.points.length-1];y.points.unshift(M.intersectRect(g,e)),y.points.push(M.intersectRect(a,t))})}function E(T){T.edges().forEach((N)=>{let y=T.edge(N);if(Object.hasOwn(y,"x")){if(y.labelpos==="l"||y.labelpos==="r")y.width-=y.labeloffset;switch(y.labelpos){case"l":y.x-=y.width/2+y.labeloffset;break;case"r":y.x+=y.width/2+y.labeloffset;break}}})}function d(T){T.edges().forEach((N)=>{let y=T.edge(N);if(y.reversed)y.points.reverse()})}function l(T){T.nodes().forEach((N)=>{if(T.children(N).length){let y=T.node(N),g=T.node(y.borderTop),a=T.node(y.borderBottom),e=T.node(y.borderLeft[y.borderLeft.length-1]),t=T.node(y.borderRight[y.borderRight.length-1]);y.width=Math.abs(t.x-e.x),y.height=Math.abs(a.y-g.y),y.x=e.x+y.width/2,y.y=g.y+y.height/2}}),T.nodes().forEach((N)=>{if(T.node(N).dummy==="border")T.removeNode(N)})}function p(T){T.edges().forEach((N)=>{if(N.v===N.w){var y=T.node(N.v);if(!y.selfEdges)y.selfEdges=[];y.selfEdges.push({e:N,label:T.edge(N)}),T.removeEdge(N)}})}function h(T){var N=M.buildLayerMatrix(T);N.forEach((y)=>{var g=0;y.forEach((a,e)=>{var t=T.node(a);t.order=e+g,(t.selfEdges||[]).forEach((z0)=>{M.addDummyNode(T,"selfedge",{width:z0.label.width,height:z0.label.height,rank:t.rank,order:e+ ++g,e:z0.e,label:z0.label},"_se")}),delete t.selfEdges})})}function m(T){T.nodes().forEach((N)=>{var y=T.node(N);if(y.dummy==="selfedge"){var g=T.node(y.e.v),a=g.x+g.width/2,e=g.y,t=y.x-a,z0=g.height/2;T.setEdge(y.e,y.label),T.removeNode(N),y.label.points=[{x:a+2*t/3,y:e-z0},{x:a+5*t/6,y:e-z0},{x:a+t,y:e},{x:a+5*t/6,y:e+z0},{x:a+2*t/3,y:e+z0}],y.label.x=y.x,y.label.y=y.y}})}function n(T,N){return M.mapValues(M.pick(T,N),Number)}function o(T){var N={};if(T)Object.entries(T).forEach(([y,g])=>{if(typeof y==="string")y=y.toLowerCase();N[y]=g});return N}},{"./acyclic":2,"./add-border-segments":3,"./coordinate-system":4,"./nesting-graph":9,"./normalize":10,"./order":15,"./parent-dummy-chains":20,"./position":22,"./rank":24,"./util":27,"@dagrejs/graphlib":29}],9:[function(Q,Z,z){let B=Q("./util");Z.exports={run:U,cleanup:H};function U(V){let P=B.addDummyNode(V,"root",{},"_root"),W=_(V),G=Object.values(W),R=B.applyWithChunking(Math.max,G)-1,M=2*R+1;V.graph().nestingRoot=P,V.edges().forEach((D)=>V.edge(D).minlen*=M);let q=F(V)+1;V.children().forEach((D)=>j(V,P,M,q,R,W,D)),V.graph().nodeRankFactor=M}function j(V,P,W,G,R,M,q){let D=V.children(q);if(!D.length){if(q!==P)V.setEdge(P,q,{weight:0,minlen:W});return}let I=B.addBorderNode(V,"_bt"),x=B.addBorderNode(V,"_bb"),Y=V.node(q);if(V.setParent(I,q),Y.borderTop=I,V.setParent(x,q),Y.borderBottom=x,D.forEach((A)=>{j(V,P,W,G,R,M,A);let O=V.node(A),k=O.borderTop?O.borderTop:A,v=O.borderBottom?O.borderBottom:A,u=O.borderTop?G:2*G,b=k!==v?1:R-M[q]+1;V.setEdge(I,k,{weight:u,minlen:b,nestingEdge:!0}),V.setEdge(v,x,{weight:u,minlen:b,nestingEdge:!0})}),!V.parent(q))V.setEdge(P,I,{weight:0,minlen:R+M[q]})}function _(V){var P={};function W(G,R){var M=V.children(G);if(M&&M.length)M.forEach((q)=>W(q,R+1));P[G]=R}return V.children().forEach((G)=>W(G,1)),P}function F(V){return V.edges().reduce((P,W)=>P+V.edge(W).weight,0)}function H(V){var P=V.graph();V.removeNode(P.nestingRoot),delete P.nestingRoot,V.edges().forEach((W)=>{var G=V.edge(W);if(G.nestingEdge)V.removeEdge(W)})}},{"./util":27}],10:[function(Q,Z,z){let B=Q("./util");Z.exports={run:U,undo:_};function U(F){F.graph().dummyChains=[],F.edges().forEach((H)=>j(F,H))}function j(F,H){let V=H.v,P=F.node(V).rank,W=H.w,G=F.node(W).rank,R=H.name,M=F.edge(H),q=M.labelRank;if(G===P+1)return;F.removeEdge(H);let D,I,x;for(x=0,++P;P<G;++x,++P){if(M.points=[],I={width:0,height:0,edgeLabel:M,edgeObj:H,rank:P},D=B.addDummyNode(F,"edge",I,"_d"),P===q)I.width=M.width,I.height=M.height,I.dummy="edge-label",I.labelpos=M.labelpos;if(F.setEdge(V,D,{weight:M.weight},R),x===0)F.graph().dummyChains.push(D);V=D}F.setEdge(V,W,{weight:M.weight},R)}function _(F){F.graph().dummyChains.forEach((H)=>{let V=F.node(H),P=V.edgeLabel,W;F.setEdge(V.edgeObj,P);while(V.dummy){if(W=F.successors(H)[0],F.removeNode(H),P.points.push({x:V.x,y:V.y}),V.dummy==="edge-label")P.x=V.x,P.y=V.y,P.width=V.width,P.height=V.height;H=W,V=F.node(H)}})}},{"./util":27}],11:[function(Q,Z,z){Z.exports=B;function B(U,j,_){let F={},H;_.forEach((V)=>{let P=U.parent(V),W,G;while(P){if(W=U.parent(P),W)G=F[W],F[W]=P;else G=H,H=P;if(G&&G!==P){j.setEdge(G,P);return}P=W}})}},{}],12:[function(Q,Z,z){Z.exports=B;function B(U,j=[]){return j.map((_)=>{let F=U.inEdges(_);if(!F.length)return{v:_};else{let H=F.reduce((V,P)=>{let W=U.edge(P),G=U.node(P.v);return{sum:V.sum+W.weight*G.order,weight:V.weight+W.weight}},{sum:0,weight:0});return{v:_,barycenter:H.sum/H.weight,weight:H.weight}}})}},{}],13:[function(Q,Z,z){let B=Q("@dagrejs/graphlib").Graph,U=Q("../util");Z.exports=j;function j(F,H,V,P){if(!P)P=F.nodes();let W=_(F),G=new B({compound:!0}).setGraph({root:W}).setDefaultNodeLabel((R)=>F.node(R));return P.forEach((R)=>{let M=F.node(R),q=F.parent(R);if(M.rank===H||M.minRank<=H&&H<=M.maxRank){if(G.setNode(R),G.setParent(R,q||W),F[V](R).forEach((D)=>{let I=D.v===R?D.w:D.v,x=G.edge(I,R),Y=x!==void 0?x.weight:0;G.setEdge(I,R,{weight:F.edge(D).weight+Y})}),Object.hasOwn(M,"minRank"))G.setNode(R,{borderLeft:M.borderLeft[H],borderRight:M.borderRight[H]})}}),G}function _(F){var H;while(F.hasNode(H=U.uniqueId("_root")));return H}},{"../util":27,"@dagrejs/graphlib":29}],14:[function(Q,Z,z){let B=Q("../util").zipObject;Z.exports=U;function U(_,F){let H=0;for(let V=1;V<F.length;++V)H+=j(_,F[V-1],F[V]);return H}function j(_,F,H){let V=B(H,H.map((q,D)=>D)),P=F.flatMap((q)=>{return _.outEdges(q).map((D)=>{return{pos:V[D.w],weight:_.edge(D).weight}}).sort((D,I)=>D.pos-I.pos)}),W=1;while(W<H.length)W<<=1;let G=2*W-1;W-=1;let R=Array(G).fill(0),M=0;return P.forEach((q)=>{let D=q.pos+W;R[D]+=q.weight;let I=0;while(D>0){if(D%2)I+=R[D+1];D=D-1>>1,R[D]+=q.weight}M+=q.weight*I}),M}},{"../util":27}],15:[function(Q,Z,z){let B=Q("./init-order"),U=Q("./cross-count"),j=Q("./sort-subgraph"),_=Q("./build-layer-graph"),F=Q("./add-subgraph-constraints"),H=Q("@dagrejs/graphlib").Graph,V=Q("../util");Z.exports=P;function P(M,q){if(q&&typeof q.customOrder==="function"){q.customOrder(M,P);return}let D=V.maxRank(M),I=W(M,V.range(1,D+1),"inEdges"),x=W(M,V.range(D-1,-1,-1),"outEdges"),Y=B(M);if(R(M,Y),q&&q.disableOptimalOrderHeuristic)return;let A=Number.POSITIVE_INFINITY,O;for(let k=0,v=0;v<4;++k,++v){G(k%2?I:x,k%4>=2),Y=V.buildLayerMatrix(M);let u=U(M,Y);if(u<A)v=0,O=Object.assign({},Y),A=u}R(M,O)}function W(M,q,D){let I=new Map,x=(Y,A)=>{if(!I.has(Y))I.set(Y,[]);I.get(Y).push(A)};for(let Y of M.nodes()){let A=M.node(Y);if(typeof A.rank==="number")x(A.rank,Y);if(typeof A.minRank==="number"&&typeof A.maxRank==="number"){for(let O=A.minRank;O<=A.maxRank;O++)if(O!==A.rank)x(O,Y)}}return q.map(function(Y){return _(M,Y,D,I.get(Y)||[])})}function G(M,q){let D=new H;M.forEach(function(I){let x=I.graph().root,Y=j(I,x,D,q);Y.vs.forEach((A,O)=>I.node(A).order=O),F(I,D,Y.vs)})}function R(M,q){Object.values(q).forEach((D)=>D.forEach((I,x)=>M.node(I).order=x))}},{"../util":27,"./add-subgraph-constraints":11,"./build-layer-graph":13,"./cross-count":14,"./init-order":16,"./sort-subgraph":18,"@dagrejs/graphlib":29}],16:[function(Q,Z,z){let B=Q("../util");Z.exports=U;function U(j){let _={},F=j.nodes().filter((R)=>!j.children(R).length),H=F.map((R)=>j.node(R).rank),V=B.applyWithChunking(Math.max,H),P=B.range(V+1).map(()=>[]);function W(R){if(_[R])return;_[R]=!0;let M=j.node(R);P[M.rank].push(R),j.successors(R).forEach(W)}return F.sort((R,M)=>j.node(R).rank-j.node(M).rank).forEach(W),P}},{"../util":27}],17:[function(Q,Z,z){let B=Q("../util");Z.exports=U;function U(F,H){let V={};F.forEach((W,G)=>{let R=V[W.v]={indegree:0,in:[],out:[],vs:[W.v],i:G};if(W.barycenter!==void 0)R.barycenter=W.barycenter,R.weight=W.weight}),H.edges().forEach((W)=>{let G=V[W.v],R=V[W.w];if(G!==void 0&&R!==void 0)R.indegree++,G.out.push(V[W.w])});let P=Object.values(V).filter((W)=>!W.indegree);return j(P)}function j(F){let H=[];function V(W){return(G)=>{if(G.merged)return;if(G.barycenter===void 0||W.barycenter===void 0||G.barycenter>=W.barycenter)_(W,G)}}function P(W){return(G)=>{if(G.in.push(W),--G.indegree===0)F.push(G)}}while(F.length){let W=F.pop();H.push(W),W.in.reverse().forEach(V(W)),W.out.forEach(P(W))}return H.filter((W)=>!W.merged).map((W)=>{return B.pick(W,["vs","i","barycenter","weight"])})}function _(F,H){let V=0,P=0;if(F.weight)V+=F.barycenter*F.weight,P+=F.weight;if(H.weight)V+=H.barycenter*H.weight,P+=H.weight;F.vs=H.vs.concat(F.vs),F.barycenter=V/P,F.weight=P,F.i=Math.min(H.i,F.i),H.merged=!0}},{"../util":27}],18:[function(Q,Z,z){let B=Q("./barycenter"),U=Q("./resolve-conflicts"),j=Q("./sort");Z.exports=_;function _(V,P,W,G){let R=V.children(P),M=V.node(P),q=M?M.borderLeft:void 0,D=M?M.borderRight:void 0,I={};if(q)R=R.filter((O)=>O!==q&&O!==D);let x=B(V,R);x.forEach((O)=>{if(V.children(O.v).length){let k=_(V,O.v,W,G);if(I[O.v]=k,Object.hasOwn(k,"barycenter"))H(O,k)}});let Y=U(x,W);F(Y,I);let A=j(Y,G);if(q){if(A.vs=[q,A.vs,D].flat(!0),V.predecessors(q).length){let O=V.node(V.predecessors(q)[0]),k=V.node(V.predecessors(D)[0]);if(!Object.hasOwn(A,"barycenter"))A.barycenter=0,A.weight=0;A.barycenter=(A.barycenter*A.weight+O.order+k.order)/(A.weight+2),A.weight+=2}}return A}function F(V,P){V.forEach((W)=>{W.vs=W.vs.flatMap((G)=>{if(P[G])return P[G].vs;return G})})}function H(V,P){if(V.barycenter!==void 0)V.barycenter=(V.barycenter*V.weight+P.barycenter*P.weight)/(V.weight+P.weight),V.weight+=P.weight;else V.barycenter=P.barycenter,V.weight=P.weight}},{"./barycenter":12,"./resolve-conflicts":17,"./sort":19}],19:[function(Q,Z,z){let B=Q("../util");Z.exports=U;function U(F,H){let V=B.partition(F,(I)=>{return Object.hasOwn(I,"barycenter")}),P=V.lhs,W=V.rhs.sort((I,x)=>x.i-I.i),G=[],R=0,M=0,q=0;P.sort(_(!!H)),q=j(G,W,q),P.forEach((I)=>{q+=I.vs.length,G.push(I.vs),R+=I.barycenter*I.weight,M+=I.weight,q=j(G,W,q)});let D={vs:G.flat(!0)};if(M)D.barycenter=R/M,D.weight=M;return D}function j(F,H,V){let P;while(H.length&&(P=H[H.length-1]).i<=V)H.pop(),F.push(P.vs),V++;return V}function _(F){return(H,V)=>{if(H.barycenter<V.barycenter)return-1;else if(H.barycenter>V.barycenter)return 1;return!F?H.i-V.i:V.i-H.i}}},{"../util":27}],20:[function(Q,Z,z){Z.exports=B;function B(_){let F=j(_);_.graph().dummyChains.forEach((H)=>{let V=_.node(H),P=V.edgeObj,W=U(_,F,P.v,P.w),G=W.path,R=W.lca,M=0,q=G[M],D=!0;while(H!==P.w){if(V=_.node(H),D){while((q=G[M])!==R&&_.node(q).maxRank<V.rank)M++;if(q===R)D=!1}if(!D){while(M<G.length-1&&_.node(q=G[M+1]).minRank<=V.rank)M++;q=G[M]}_.setParent(H,q),H=_.successors(H)[0]}})}function U(_,F,H,V){let P=[],W=[],G=Math.min(F[H].low,F[V].low),R=Math.max(F[H].lim,F[V].lim),M,q;M=H;do M=_.parent(M),P.push(M);while(M&&(F[M].low>G||R>F[M].lim));q=M,M=V;while((M=_.parent(M))!==q)W.push(M);return{path:P.concat(W.reverse()),lca:q}}function j(_){let F={},H=0;function V(P){let W=H;_.children(P).forEach(V),F[P]={low:W,lim:H++}}return _.children().forEach(V),F}},{}],21:[function(Q,Z,z){let B=Q("@dagrejs/graphlib").Graph,U=Q("../util");Z.exports={positionX:D,findType1Conflicts:j,findType2Conflicts:_,addConflict:H,hasConflict:V,verticalAlignment:P,horizontalCompaction:W,alignCoordinates:M,findSmallestWidthAlignment:R,balance:q};function j(Y,A){let O={};function k(v,u){let b=0,f=0,X=v.length,C=u[u.length-1];return u.forEach((w,S)=>{let L=F(Y,w),c=L?Y.node(L).order:X;if(L||w===C)u.slice(f,S+1).forEach((s)=>{Y.predecessors(s).forEach((E)=>{let d=Y.node(E),l=d.order;if((l<b||c<l)&&!(d.dummy&&Y.node(s).dummy))H(O,E,s)})}),f=S+1,b=c}),u}return A.length&&A.reduce(k),O}function _(Y,A){let O={};function k(u,b,f,X,C){let w;U.range(b,f).forEach((S)=>{if(w=u[S],Y.node(w).dummy)Y.predecessors(w).forEach((L)=>{let c=Y.node(L);if(c.dummy&&(c.order<X||c.order>C))H(O,L,w)})})}function v(u,b){let f=-1,X,C=0;return b.forEach((w,S)=>{if(Y.node(w).dummy==="border"){let L=Y.predecessors(w);if(L.length)X=Y.node(L[0]).order,k(b,C,S,f,X),C=S,f=X}k(b,C,b.length,X,u.length)}),b}return A.length&&A.reduce(v),O}function F(Y,A){if(Y.node(A).dummy)return Y.predecessors(A).find((O)=>Y.node(O).dummy)}function H(Y,A,O){if(A>O){let v=A;A=O,O=v}let k=Y[A];if(!k)Y[A]=k={};k[O]=!0}function V(Y,A,O){if(A>O){let k=A;A=O,O=k}return!!Y[A]&&Object.hasOwn(Y[A],O)}function P(Y,A,O,k){let v={},u={},b={};return A.forEach((f)=>{f.forEach((X,C)=>{v[X]=X,u[X]=X,b[X]=C})}),A.forEach((f)=>{let X=-1;f.forEach((C)=>{let w=k(C);if(w.length){w=w.sort((L,c)=>b[L]-b[c]);let S=(w.length-1)/2;for(let L=Math.floor(S),c=Math.ceil(S);L<=c;++L){let s=w[L];if(u[C]===C&&X<b[s]&&!V(O,C,s))u[s]=C,u[C]=v[C]=v[s],X=b[s]}}})}),{root:v,align:u}}function W(Y,A,O,k,v){let u={},b=G(Y,A,O,v),f=v?"borderLeft":"borderRight";function X(S,L){let c=b.nodes(),s=c.pop(),E={};while(s){if(E[s])S(s);else E[s]=!0,c.push(s),c=c.concat(L(s));s=c.pop()}}function C(S){u[S]=b.inEdges(S).reduce((L,c)=>{return Math.max(L,u[c.v]+b.edge(c))},0)}function w(S){let L=b.outEdges(S).reduce((s,E)=>{return Math.min(s,u[E.w]-b.edge(E))},Number.POSITIVE_INFINITY),c=Y.node(S);if(L!==Number.POSITIVE_INFINITY&&c.borderType!==f)u[S]=Math.max(u[S],L)}return X(C,b.predecessors.bind(b)),X(w,b.successors.bind(b)),Object.keys(k).forEach((S)=>u[S]=u[O[S]]),u}function G(Y,A,O,k){let v=new B,u=Y.graph(),b=I(u.nodesep,u.edgesep,k);return A.forEach((f)=>{let X;f.forEach((C)=>{let w=O[C];if(v.setNode(w),X){var S=O[X],L=v.edge(S,w);v.setEdge(S,w,Math.max(b(Y,C,X),L||0))}X=C})}),v}function R(Y,A){return Object.values(A).reduce((O,k)=>{let{NEGATIVE_INFINITY:v,POSITIVE_INFINITY:u}=Number;Object.entries(k).forEach(([f,X])=>{let C=x(Y,f)/2;v=Math.max(X+C,v),u=Math.min(X-C,u)});let b=v-u;if(b<O[0])O=[b,k];return O},[Number.POSITIVE_INFINITY,null])[1]}function M(Y,A){let O=Object.values(A),k=U.applyWithChunking(Math.min,O),v=U.applyWithChunking(Math.max,O);["u","d"].forEach((u)=>{["l","r"].forEach((b)=>{let f=u+b,X=Y[f];if(X===A)return;let C=Object.values(X),w=k-U.applyWithChunking(Math.min,C);if(b!=="l")w=v-U.applyWithChunking(Math.max,C);if(w)Y[f]=U.mapValues(X,(S)=>S+w)})})}function q(Y,A){return U.mapValues(Y.ul,(O,k)=>{if(A)return Y[A.toLowerCase()][k];else{let v=Object.values(Y).map((u)=>u[k]).sort((u,b)=>u-b);return(v[1]+v[2])/2}})}function D(Y){let A=U.buildLayerMatrix(Y),O=Object.assign(j(Y,A),_(Y,A)),k={},v;["u","d"].forEach((b)=>{v=b==="u"?A:Object.values(A).reverse(),["l","r"].forEach((f)=>{if(f==="r")v=v.map((S)=>{return Object.values(S).reverse()});let X=(b==="u"?Y.predecessors:Y.successors).bind(Y),C=P(Y,v,O,X),w=W(Y,v,C.root,C.align,f==="r");if(f==="r")w=U.mapValues(w,(S)=>-S);k[b+f]=w})});let u=R(Y,k);return M(k,u),q(k,Y.graph().align)}function I(Y,A,O){return(k,v,u)=>{let b=k.node(v),f=k.node(u),X=0,C;if(X+=b.width/2,Object.hasOwn(b,"labelpos"))switch(b.labelpos.toLowerCase()){case"l":C=-b.width/2;break;case"r":C=b.width/2;break}if(C)X+=O?C:-C;if(C=0,X+=(b.dummy?A:Y)/2,X+=(f.dummy?A:Y)/2,X+=f.width/2,Object.hasOwn(f,"labelpos"))switch(f.labelpos.toLowerCase()){case"l":C=f.width/2;break;case"r":C=-f.width/2;break}if(C)X+=O?C:-C;return C=0,X}}function x(Y,A){return Y.node(A).width}},{"../util":27,"@dagrejs/graphlib":29}],22:[function(Q,Z,z){let B=Q("../util"),U=Q("./bk").positionX;Z.exports=j;function j(F){F=B.asNonCompoundGraph(F),_(F),Object.entries(U(F)).forEach(([H,V])=>F.node(H).x=V)}function _(F){let H=B.buildLayerMatrix(F),V=F.graph().ranksep,P=0;H.forEach((W)=>{let G=W.reduce((R,M)=>{let q=F.node(M).height;if(R>q)return R;else return q},0);W.forEach((R)=>F.node(R).y=P+G/2),P+=G+V})}},{"../util":27,"./bk":21}],23:[function(Q,Z,z){var B=Q("@dagrejs/graphlib").Graph,U=Q("./util").slack;Z.exports=j;function j(V){var P=new B({directed:!1}),W=V.nodes()[0],G=V.nodeCount();P.setNode(W,{});var R,M;while(_(P,V)<G)R=F(P,V),M=P.hasNode(R.v)?U(V,R):-U(V,R),H(P,V,M);return P}function _(V,P){function W(G){P.nodeEdges(G).forEach((R)=>{var M=R.v,q=G===M?R.w:M;if(!V.hasNode(q)&&!U(P,R))V.setNode(q,{}),V.setEdge(G,q,{}),W(q)})}return V.nodes().forEach(W),V.nodeCount()}function F(V,P){return P.edges().reduce((G,R)=>{let M=Number.POSITIVE_INFINITY;if(V.hasNode(R.v)!==V.hasNode(R.w))M=U(P,R);if(M<G[0])return[M,R];return G},[Number.POSITIVE_INFINITY,null])[1]}function H(V,P,W){V.nodes().forEach((G)=>P.node(G).rank+=W)}},{"./util":26,"@dagrejs/graphlib":29}],24:[function(Q,Z,z){var B=Q("./util"),U=B.longestPath,j=Q("./feasible-tree"),_=Q("./network-simplex");Z.exports=F;function F(W){var G=W.graph().ranker;if(G instanceof Function)return G(W);switch(W.graph().ranker){case"network-simplex":P(W);break;case"tight-tree":V(W);break;case"longest-path":H(W);break;case"none":break;default:P(W)}}var H=U;function V(W){U(W),j(W)}function P(W){_(W)}},{"./feasible-tree":23,"./network-simplex":25,"./util":26}],25:[function(Q,Z,z){var B=Q("./feasible-tree"),U=Q("./util").slack,j=Q("./util").longestPath,_=Q("@dagrejs/graphlib").alg.preorder,F=Q("@dagrejs/graphlib").alg.postorder,H=Q("../util").simplify;Z.exports=V,V.initLowLimValues=R,V.initCutValues=P,V.calcCutValue=G,V.leaveEdge=q,V.enterEdge=D,V.exchangeEdges=I;function V(O){O=H(O),j(O);var k=B(O);R(k),P(k,O);var v,u;while(v=q(k))u=D(k,O,v),I(k,O,v,u)}function P(O,k){var v=F(O,O.nodes());v=v.slice(0,v.length-1),v.forEach((u)=>W(O,k,u))}function W(O,k,v){var u=O.node(v),b=u.parent;O.edge(v,b).cutvalue=G(O,k,v)}function G(O,k,v){var u=O.node(v),b=u.parent,f=!0,X=k.edge(v,b),C=0;if(!X)f=!1,X=k.edge(b,v);return C=X.weight,k.nodeEdges(v).forEach((w)=>{var S=w.v===v,L=S?w.w:w.v;if(L!==b){var c=S===f,s=k.edge(w).weight;if(C+=c?s:-s,Y(O,v,L)){var E=O.edge(v,L).cutvalue;C+=c?-E:E}}}),C}function R(O,k){if(arguments.length<2)k=O.nodes()[0];M(O,{},1,k)}function M(O,k,v,u,b){var f=v,X=O.node(u);if(k[u]=!0,O.neighbors(u).forEach((C)=>{if(!Object.hasOwn(k,C))v=M(O,k,v,C,u)}),X.low=f,X.lim=v++,b)X.parent=b;else delete X.parent;return v}function q(O){return O.edges().find((k)=>O.edge(k).cutvalue<0)}function D(O,k,v){var{v:u,w:b}=v;if(!k.hasEdge(u,b))u=v.w,b=v.v;var f=O.node(u),X=O.node(b),C=f,w=!1;if(f.lim>X.lim)C=X,w=!0;var S=k.edges().filter((L)=>{return w===A(O,O.node(L.v),C)&&w!==A(O,O.node(L.w),C)});return S.reduce((L,c)=>{if(U(k,c)<U(k,L))return c;return L})}function I(O,k,v,u){var{v:b,w:f}=v;O.removeEdge(b,f),O.setEdge(u.v,u.w,{}),R(O),P(O,k),x(O,k)}function x(O,k){var v=O.nodes().find((b)=>!k.node(b).parent),u=_(O,v);u=u.slice(1),u.forEach((b)=>{var f=O.node(b).parent,X=k.edge(b,f),C=!1;if(!X)X=k.edge(f,b),C=!0;k.node(b).rank=k.node(f).rank+(C?X.minlen:-X.minlen)})}function Y(O,k,v){return O.hasEdge(k,v)}function A(O,k,v){return v.low<=k.lim&&k.lim<=v.lim}},{"../util":27,"./feasible-tree":23,"./util":26,"@dagrejs/graphlib":29}],26:[function(Q,Z,z){let{applyWithChunking:B}=Q("../util");Z.exports={longestPath:U,slack:j};function U(_){var F={};function H(V){var P=_.node(V);if(Object.hasOwn(F,V))return P.rank;F[V]=!0;let W=_.outEdges(V).map((R)=>{if(R==null)return Number.POSITIVE_INFINITY;return H(R.w)-_.edge(R).minlen});var G=B(Math.min,W);if(G===Number.POSITIVE_INFINITY)G=0;return P.rank=G}_.sources().forEach(H)}function j(_,F){return _.node(F.w).rank-_.node(F.v).rank-_.edge(F).minlen}},{"../util":27}],27:[function(Q,Z,z){let B=Q("@dagrejs/graphlib").Graph;Z.exports={addBorderNode:R,addDummyNode:U,applyWithChunking:D,asNonCompoundGraph:_,buildLayerMatrix:P,intersectRect:V,mapValues:b,maxRank:I,normalizeRanks:W,notime:A,partition:x,pick:u,predecessorWeights:H,range:v,removeEmptyRanks:G,simplify:j,successorWeights:F,time:Y,uniqueId:k,zipObject:f};function U(X,C,w,S){var L=S;while(X.hasNode(L))L=k(S);return w.dummy=C,X.setNode(L,w),L}function j(X){let C=new B().setGraph(X.graph());return X.nodes().forEach((w)=>C.setNode(w,X.node(w))),X.edges().forEach((w)=>{let S=C.edge(w.v,w.w)||{weight:0,minlen:1},L=X.edge(w);C.setEdge(w.v,w.w,{weight:S.weight+L.weight,minlen:Math.max(S.minlen,L.minlen)})}),C}function _(X){let C=new B({multigraph:X.isMultigraph()}).setGraph(X.graph());return X.nodes().forEach((w)=>{if(!X.children(w).length)C.setNode(w,X.node(w))}),X.edges().forEach((w)=>{C.setEdge(w,X.edge(w))}),C}function F(X){let C=X.nodes().map((w)=>{let S={};return X.outEdges(w).forEach((L)=>{S[L.w]=(S[L.w]||0)+X.edge(L).weight}),S});return f(X.nodes(),C)}function H(X){let C=X.nodes().map((w)=>{let S={};return X.inEdges(w).forEach((L)=>{S[L.v]=(S[L.v]||0)+X.edge(L).weight}),S});return f(X.nodes(),C)}function V(X,C){let{x:w,y:S}=X,L=C.x-w,c=C.y-S,s=X.width/2,E=X.height/2;if(!L&&!c)throw Error("Not possible to find intersection inside of the rectangle");let d,l;if(Math.abs(c)*s>Math.abs(L)*E){if(c<0)E=-E;d=E*L/c,l=E}else{if(L<0)s=-s;d=s,l=s*c/L}return{x:w+d,y:S+l}}function P(X){let C=v(I(X)+1).map(()=>[]);return X.nodes().forEach((w)=>{let S=X.node(w),L=S.rank;if(L!==void 0)C[L][S.order]=w}),C}function W(X){let C=X.nodes().map((S)=>{let L=X.node(S).rank;if(L===void 0)return Number.MAX_VALUE;return L}),w=D(Math.min,C);X.nodes().forEach((S)=>{let L=X.node(S);if(Object.hasOwn(L,"rank"))L.rank-=w})}function G(X){let C=X.nodes().map((s)=>X.node(s).rank),w=D(Math.min,C),S=[];X.nodes().forEach((s)=>{let E=X.node(s).rank-w;if(!S[E])S[E]=[];S[E].push(s)});let L=0,c=X.graph().nodeRankFactor;Array.from(S).forEach((s,E)=>{if(s===void 0&&E%c!==0)--L;else if(s!==void 0&&L)s.forEach((d)=>X.node(d).rank+=L)})}function R(X,C,w,S){let L={width:0,height:0};if(arguments.length>=4)L.rank=w,L.order=S;return U(X,"border",L,C)}function M(X,C=q){let w=[];for(let S=0;S<X.length;S+=C){let L=X.slice(S,S+C);w.push(L)}return w}let q=65535;function D(X,C){if(C.length>q){let w=M(C);return X.apply(null,w.map((S)=>X.apply(null,S)))}else return X.apply(null,C)}function I(X){let w=X.nodes().map((S)=>{let L=X.node(S).rank;if(L===void 0)return Number.MIN_VALUE;return L});return D(Math.max,w)}function x(X,C){let w={lhs:[],rhs:[]};return X.forEach((S)=>{if(C(S))w.lhs.push(S);else w.rhs.push(S)}),w}function Y(X,C){let w=Date.now();try{return C()}finally{console.log(X+" time: "+(Date.now()-w)+"ms")}}function A(X,C){return C()}let O=0;function k(X){var C=++O;return X+(""+C)}function v(X,C,w=1){if(C==null)C=X,X=0;let S=(c)=>c<C;if(w<0)S=(c)=>C<c;let L=[];for(let c=X;S(c);c+=w)L.push(c);return L}function u(X,C){let w={};for(let S of C)if(X[S]!==void 0)w[S]=X[S];return w}function b(X,C){let w=C;if(typeof C==="string")w=(S)=>S[C];return Object.entries(X).reduce((S,[L,c])=>{return S[L]=w(c,L),S},{})}function f(X,C){return X.reduce((w,S,L)=>{return w[S]=C[L],w},{})}},{"@dagrejs/graphlib":29}],28:[function(Q,Z,z){Z.exports="1.1.8"},{}],29:[function(Q,Z,z){var B=Q("./lib");Z.exports={Graph:B.Graph,json:Q("./lib/json"),alg:Q("./lib/alg"),version:B.version}},{"./lib":45,"./lib/alg":36,"./lib/json":46}],30:[function(Q,Z,z){Z.exports=B;function B(U){var j={},_=[],F;function H(V){if(Object.hasOwn(j,V))return;j[V]=!0,F.push(V),U.successors(V).forEach(H),U.predecessors(V).forEach(H)}return U.nodes().forEach(function(V){if(F=[],H(V),F.length)_.push(F)}),_}},{}],31:[function(Q,Z,z){Z.exports=B;function B(F,H,V){if(!Array.isArray(H))H=[H];var P=F.isDirected()?(M)=>F.successors(M):(M)=>F.neighbors(M),W=V==="post"?U:j,G=[],R={};return H.forEach((M)=>{if(!F.hasNode(M))throw Error("Graph does not have node: "+M);W(M,P,R,G)}),G}function U(F,H,V,P){var W=[[F,!1]];while(W.length>0){var G=W.pop();if(G[1])P.push(G[0]);else if(!Object.hasOwn(V,G[0]))V[G[0]]=!0,W.push([G[0],!0]),_(H(G[0]),(R)=>W.push([R,!1]))}}function j(F,H,V,P){var W=[F];while(W.length>0){var G=W.pop();if(!Object.hasOwn(V,G))V[G]=!0,P.push(G),_(H(G),(R)=>W.push(R))}}function _(F,H){var V=F.length;while(V--)H(F[V],V,F);return F}},{}],32:[function(Q,Z,z){var B=Q("./dijkstra");Z.exports=U;function U(j,_,F){return j.nodes().reduce(function(H,V){return H[V]=B(j,V,_,F),H},{})}},{"./dijkstra":33}],33:[function(Q,Z,z){var B=Q("../data/priority-queue");Z.exports=j;var U=()=>1;function j(F,H,V,P){return _(F,String(H),V||U,P||function(W){return F.outEdges(W)})}function _(F,H,V,P){var W={},G=new B,R,M,q=function(D){var I=D.v!==R?D.v:D.w,x=W[I],Y=V(D),A=M.distance+Y;if(Y<0)throw Error("dijkstra does not allow negative edge weights. Bad edge: "+D+" Weight: "+Y);if(A<x.distance)x.distance=A,x.predecessor=R,G.decrease(I,A)};F.nodes().forEach(function(D){var I=D===H?0:Number.POSITIVE_INFINITY;W[D]={distance:I},G.add(D,I)});while(G.size()>0){if(R=G.removeMin(),M=W[R],M.distance===Number.POSITIVE_INFINITY)break;P(R).forEach(q)}return W}},{"../data/priority-queue":43}],34:[function(Q,Z,z){var B=Q("./tarjan");Z.exports=U;function U(j){return B(j).filter(function(_){return _.length>1||_.length===1&&j.hasEdge(_[0],_[0])})}},{"./tarjan":41}],35:[function(Q,Z,z){Z.exports=U;var B=()=>1;function U(_,F,H){return j(_,F||B,H||function(V){return _.outEdges(V)})}function j(_,F,H){var V={},P=_.nodes();return P.forEach(function(W){V[W]={},V[W][W]={distance:0},P.forEach(function(G){if(W!==G)V[W][G]={distance:Number.POSITIVE_INFINITY}}),H(W).forEach(function(G){var R=G.v===W?G.w:G.v,M=F(G);V[W][R]={distance:M,predecessor:W}})}),P.forEach(function(W){var G=V[W];P.forEach(function(R){var M=V[R];P.forEach(function(q){var D=M[W],I=G[q],x=M[q],Y=D.distance+I.distance;if(Y<x.distance)x.distance=Y,x.predecessor=I.predecessor})})}),V}},{}],36:[function(Q,Z,z){Z.exports={components:Q("./components"),dijkstra:Q("./dijkstra"),dijkstraAll:Q("./dijkstra-all"),findCycles:Q("./find-cycles"),floydWarshall:Q("./floyd-warshall"),isAcyclic:Q("./is-acyclic"),postorder:Q("./postorder"),preorder:Q("./preorder"),prim:Q("./prim"),tarjan:Q("./tarjan"),topsort:Q("./topsort")}},{"./components":30,"./dijkstra":33,"./dijkstra-all":32,"./find-cycles":34,"./floyd-warshall":35,"./is-acyclic":37,"./postorder":38,"./preorder":39,"./prim":40,"./tarjan":41,"./topsort":42}],37:[function(Q,Z,z){var B=Q("./topsort");Z.exports=U;function U(j){try{B(j)}catch(_){if(_ instanceof B.CycleException)return!1;throw _}return!0}},{"./topsort":42}],38:[function(Q,Z,z){var B=Q("./dfs");Z.exports=U;function U(j,_){return B(j,_,"post")}},{"./dfs":31}],39:[function(Q,Z,z){var B=Q("./dfs");Z.exports=U;function U(j,_){return B(j,_,"pre")}},{"./dfs":31}],40:[function(Q,Z,z){var B=Q("../graph"),U=Q("../data/priority-queue");Z.exports=j;function j(_,F){var H=new B,V={},P=new U,W;function G(M){var q=M.v===W?M.w:M.v,D=P.priority(q);if(D!==void 0){var I=F(M);if(I<D)V[q]=W,P.decrease(q,I)}}if(_.nodeCount()===0)return H;_.nodes().forEach(function(M){P.add(M,Number.POSITIVE_INFINITY),H.setNode(M)}),P.decrease(_.nodes()[0],0);var R=!1;while(P.size()>0){if(W=P.removeMin(),Object.hasOwn(V,W))H.setEdge(W,V[W]);else if(R)throw Error("Input graph is not connected: "+_);else R=!0;_.nodeEdges(W).forEach(G)}return H}},{"../data/priority-queue":43,"../graph":44}],41:[function(Q,Z,z){Z.exports=B;function B(U){var j=0,_=[],F={},H=[];function V(P){var W=F[P]={onStack:!0,lowlink:j,index:j++};if(_.push(P),U.successors(P).forEach(function(M){if(!Object.hasOwn(F,M))V(M),W.lowlink=Math.min(W.lowlink,F[M].lowlink);else if(F[M].onStack)W.lowlink=Math.min(W.lowlink,F[M].index)}),W.lowlink===W.index){var G=[],R;do R=_.pop(),F[R].onStack=!1,G.push(R);while(P!==R);H.push(G)}}return U.nodes().forEach(function(P){if(!Object.hasOwn(F,P))V(P)}),H}},{}],42:[function(Q,Z,z){function B(j){var _={},F={},H=[];function V(P){if(Object.hasOwn(F,P))throw new U;if(!Object.hasOwn(_,P))F[P]=!0,_[P]=!0,j.predecessors(P).forEach(V),delete F[P],H.push(P)}if(j.sinks().forEach(V),Object.keys(_).length!==j.nodeCount())throw new U;return H}class U extends Error{constructor(){super(...arguments)}}Z.exports=B,B.CycleException=U},{}],43:[function(Q,Z,z){class B{_arr=[];_keyIndices={};size(){return this._arr.length}keys(){return this._arr.map(function(U){return U.key})}has(U){return Object.hasOwn(this._keyIndices,U)}priority(U){var j=this._keyIndices[U];if(j!==void 0)return this._arr[j].priority}min(){if(this.size()===0)throw Error("Queue underflow");return this._arr[0].key}add(U,j){var _=this._keyIndices;if(U=String(U),!Object.hasOwn(_,U)){var F=this._arr,H=F.length;return _[U]=H,F.push({key:U,priority:j}),this._decrease(H),!0}return!1}removeMin(){this._swap(0,this._arr.length-1);var U=this._arr.pop();return delete this._keyIndices[U.key],this._heapify(0),U.key}decrease(U,j){var _=this._keyIndices[U];if(j>this._arr[_].priority)throw Error("New priority is greater than current priority. Key: "+U+" Old: "+this._arr[_].priority+" New: "+j);this._arr[_].priority=j,this._decrease(_)}_heapify(U){var j=this._arr,_=2*U,F=_+1,H=U;if(_<j.length){if(H=j[_].priority<j[H].priority?_:H,F<j.length)H=j[F].priority<j[H].priority?F:H;if(H!==U)this._swap(U,H),this._heapify(H)}}_decrease(U){var j=this._arr,_=j[U].priority,F;while(U!==0){if(F=U>>1,j[F].priority<_)break;this._swap(U,F),U=F}}_swap(U,j){var _=this._arr,F=this._keyIndices,H=_[U],V=_[j];_[U]=V,_[j]=H,F[V.key]=U,F[H.key]=j}}Z.exports=B},{}],44:[function(Q,Z,z){var B="\x00",U="\x00",j="\x01";class _{_isDirected=!0;_isMultigraph=!1;_isCompound=!1;_label;_defaultNodeLabelFn=()=>{return};_defaultEdgeLabelFn=()=>{return};_nodes={};_in={};_preds={};_out={};_sucs={};_edgeObjs={};_edgeLabels={};_nodeCount=0;_edgeCount=0;_parent;_children;constructor(G){if(G)this._isDirected=Object.hasOwn(G,"directed")?G.directed:!0,this._isMultigraph=Object.hasOwn(G,"multigraph")?G.multigraph:!1,this._isCompound=Object.hasOwn(G,"compound")?G.compound:!1;if(this._isCompound)this._parent={},this._children={},this._children[U]={}}isDirected(){return this._isDirected}isMultigraph(){return this._isMultigraph}isCompound(){return this._isCompound}setGraph(G){return this._label=G,this}graph(){return this._label}setDefaultNodeLabel(G){if(this._defaultNodeLabelFn=G,typeof G!=="function")this._defaultNodeLabelFn=()=>G;return this}nodeCount(){return this._nodeCount}nodes(){return Object.keys(this._nodes)}sources(){var G=this;return this.nodes().filter((R)=>Object.keys(G._in[R]).length===0)}sinks(){var G=this;return this.nodes().filter((R)=>Object.keys(G._out[R]).length===0)}setNodes(G,R){var M=arguments,q=this;return G.forEach(function(D){if(M.length>1)q.setNode(D,R);else q.setNode(D)}),this}setNode(G,R){if(Object.hasOwn(this._nodes,G)){if(arguments.length>1)this._nodes[G]=R;return this}if(this._nodes[G]=arguments.length>1?R:this._defaultNodeLabelFn(G),this._isCompound)this._parent[G]=U,this._children[G]={},this._children[U][G]=!0;return this._in[G]={},this._preds[G]={},this._out[G]={},this._sucs[G]={},++this._nodeCount,this}node(G){return this._nodes[G]}hasNode(G){return Object.hasOwn(this._nodes,G)}removeNode(G){var R=this;if(Object.hasOwn(this._nodes,G)){var M=(q)=>R.removeEdge(R._edgeObjs[q]);if(delete this._nodes[G],this._isCompound)this._removeFromParentsChildList(G),delete this._parent[G],this.children(G).forEach(function(q){R.setParent(q)}),delete this._children[G];Object.keys(this._in[G]).forEach(M),delete this._in[G],delete this._preds[G],Object.keys(this._out[G]).forEach(M),delete this._out[G],delete this._sucs[G],--this._nodeCount}return this}setParent(G,R){if(!this._isCompound)throw Error("Cannot set parent in a non-compound graph");if(R===void 0)R=U;else{R+="";for(var M=R;M!==void 0;M=this.parent(M))if(M===G)throw Error("Setting "+R+" as parent of "+G+" would create a cycle");this.setNode(R)}return this.setNode(G),this._removeFromParentsChildList(G),this._parent[G]=R,this._children[R][G]=!0,this}_removeFromParentsChildList(G){delete this._children[this._parent[G]][G]}parent(G){if(this._isCompound){var R=this._parent[G];if(R!==U)return R}}children(G=U){if(this._isCompound){var R=this._children[G];if(R)return Object.keys(R)}else if(G===U)return this.nodes();else if(this.hasNode(G))return[]}predecessors(G){var R=this._preds[G];if(R)return Object.keys(R)}successors(G){var R=this._sucs[G];if(R)return Object.keys(R)}neighbors(G){var R=this.predecessors(G);if(R){let q=new Set(R);for(var M of this.successors(G))q.add(M);return Array.from(q.values())}}isLeaf(G){var R;if(this.isDirected())R=this.successors(G);else R=this.neighbors(G);return R.length===0}filterNodes(G){var R=new this.constructor({directed:this._isDirected,multigraph:this._isMultigraph,compound:this._isCompound});R.setGraph(this.graph());var M=this;Object.entries(this._nodes).forEach(function([I,x]){if(G(I))R.setNode(I,x)}),Object.values(this._edgeObjs).forEach(function(I){if(R.hasNode(I.v)&&R.hasNode(I.w))R.setEdge(I,M.edge(I))});var q={};function D(I){var x=M.parent(I);if(x===void 0||R.hasNode(x))return q[I]=x,x;else if(x in q)return q[x];else return D(x)}if(this._isCompound)R.nodes().forEach((I)=>R.setParent(I,D(I)));return R}setDefaultEdgeLabel(G){if(this._defaultEdgeLabelFn=G,typeof G!=="function")this._defaultEdgeLabelFn=()=>G;return this}edgeCount(){return this._edgeCount}edges(){return Object.values(this._edgeObjs)}setPath(G,R){var M=this,q=arguments;return G.reduce(function(D,I){if(q.length>1)M.setEdge(D,I,R);else M.setEdge(D,I);return I}),this}setEdge(){var G,R,M,q,D=!1,I=arguments[0];if(typeof I==="object"&&I!==null&&"v"in I){if(G=I.v,R=I.w,M=I.name,arguments.length===2)q=arguments[1],D=!0}else if(G=I,R=arguments[1],M=arguments[3],arguments.length>2)q=arguments[2],D=!0;if(G=""+G,R=""+R,M!==void 0)M=""+M;var x=V(this._isDirected,G,R,M);if(Object.hasOwn(this._edgeLabels,x)){if(D)this._edgeLabels[x]=q;return this}if(M!==void 0&&!this._isMultigraph)throw Error("Cannot set a named edge when isMultigraph = false");this.setNode(G),this.setNode(R),this._edgeLabels[x]=D?q:this._defaultEdgeLabelFn(G,R,M);var Y=P(this._isDirected,G,R,M);return G=Y.v,R=Y.w,Object.freeze(Y),this._edgeObjs[x]=Y,F(this._preds[R],G),F(this._sucs[G],R),this._in[R][x]=Y,this._out[G][x]=Y,this._edgeCount++,this}edge(G,R,M){var q=arguments.length===1?W(this._isDirected,arguments[0]):V(this._isDirected,G,R,M);return this._edgeLabels[q]}edgeAsObj(){let G=this.edge(...arguments);if(typeof G!=="object")return{label:G};return G}hasEdge(G,R,M){var q=arguments.length===1?W(this._isDirected,arguments[0]):V(this._isDirected,G,R,M);return Object.hasOwn(this._edgeLabels,q)}removeEdge(G,R,M){var q=arguments.length===1?W(this._isDirected,arguments[0]):V(this._isDirected,G,R,M),D=this._edgeObjs[q];if(D)G=D.v,R=D.w,delete this._edgeLabels[q],delete this._edgeObjs[q],H(this._preds[R],G),H(this._sucs[G],R),delete this._in[R][q],delete this._out[G][q],this._edgeCount--;return this}inEdges(G,R){var M=this._in[G];if(M){var q=Object.values(M);if(!R)return q;return q.filter((D)=>D.v===R)}}outEdges(G,R){var M=this._out[G];if(M){var q=Object.values(M);if(!R)return q;return q.filter((D)=>D.w===R)}}nodeEdges(G,R){var M=this.inEdges(G,R);if(M)return M.concat(this.outEdges(G,R))}}function F(G,R){if(G[R])G[R]++;else G[R]=1}function H(G,R){if(!--G[R])delete G[R]}function V(G,R,M,q){var D=""+R,I=""+M;if(!G&&D>I){var x=D;D=I,I=x}return D+j+I+j+(q===void 0?B:q)}function P(G,R,M,q){var D=""+R,I=""+M;if(!G&&D>I){var x=D;D=I,I=x}var Y={v:D,w:I};if(q)Y.name=q;return Y}function W(G,R){return V(G,R.v,R.w,R.name)}Z.exports=_},{}],45:[function(Q,Z,z){Z.exports={Graph:Q("./graph"),version:Q("./version")}},{"./graph":44,"./version":47}],46:[function(Q,Z,z){var B=Q("./graph");Z.exports={write:U,read:F};function U(H){var V={options:{directed:H.isDirected(),multigraph:H.isMultigraph(),compound:H.isCompound()},nodes:j(H),edges:_(H)};if(H.graph()!==void 0)V.value=structuredClone(H.graph());return V}function j(H){return H.nodes().map(function(V){var P=H.node(V),W=H.parent(V),G={v:V};if(P!==void 0)G.value=P;if(W!==void 0)G.parent=W;return G})}function _(H){return H.edges().map(function(V){var P=H.edge(V),W={v:V.v,w:V.w};if(V.name!==void 0)W.name=V.name;if(P!==void 0)W.value=P;return W})}function F(H){var V=new B(H.options).setGraph(H.value);return H.nodes.forEach(function(P){if(V.setNode(P.v,P.value),P.parent)V.setParent(P.v,P.parent)}),H.edges.forEach(function(P){V.setEdge({v:P.v,w:P.w,name:P.name},P.value)}),V}},{"./graph":44}],47:[function(Q,Z,z){Z.exports="2.2.4"},{}]},{},[1])(1)})});var I9={};_7(I9,{renderMermaidAscii:()=>o6,renderMermaid:()=>K7});module.exports=B7(I9);var Y0=z7(Y6(),1),A6={bg:"#FFFFFF",fg:"#27272A"},M0={textSec:60,textMuted:40,textFaint:25,line:30,arrow:50,nodeFill:3,nodeStroke:20,groupHeader:5,innerStroke:12,keyBadge:10};function r0($,J){let K=[`@import url('https://fonts.googleapis.com/css2?family=${encodeURIComponent($)}:wght@400;500;600;700&amp;display=swap');`,...J?["@import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500&amp;display=swap');"]:[]],Q=`
    /* Derived from --bg and --fg (overridable via --line, --accent, etc.) */
    --_text:          var(--fg);
    --_text-sec:      var(--muted, color-mix(in srgb, var(--fg) ${M0.textSec}%, var(--bg)));
    --_text-muted:    var(--muted, color-mix(in srgb, var(--fg) ${M0.textMuted}%, var(--bg)));
    --_text-faint:    color-mix(in srgb, var(--fg) ${M0.textFaint}%, var(--bg));
    --_line:          var(--line, color-mix(in srgb, var(--fg) ${M0.line}%, var(--bg)));
    --_arrow:         var(--accent, color-mix(in srgb, var(--fg) ${M0.arrow}%, var(--bg)));
    --_node-fill:     var(--surface, color-mix(in srgb, var(--fg) ${M0.nodeFill}%, var(--bg)));
    --_node-stroke:   var(--border, color-mix(in srgb, var(--fg) ${M0.nodeStroke}%, var(--bg)));
    --_group-fill:    var(--bg);
    --_group-hdr:     color-mix(in srgb, var(--fg) ${M0.groupHeader}%, var(--bg));
    --_inner-stroke:  color-mix(in srgb, var(--fg) ${M0.innerStroke}%, var(--bg));
    --_key-badge:     color-mix(in srgb, var(--fg) ${M0.keyBadge}%, var(--bg));`;return["<style>",`  ${K.join(`
  `)}`,`  text { font-family: '${$}', system-ui, sans-serif; }`,...J?["  .mono { font-family: 'JetBrains Mono', 'SF Mono', 'Fira Code', ui-monospace, monospace; }"]:[],`  svg {${Q}`,"  }","</style>"].join(`
`)}function e0($,J,K,Q){let Z=[`--bg:${K.bg}`,`--fg:${K.fg}`,K.line?`--line:${K.line}`:"",K.accent?`--accent:${K.accent}`:"",K.muted?`--muted:${K.muted}`:"",K.surface?`--surface:${K.surface}`:"",K.border?`--border:${K.border}`:""].filter(Boolean).join(";");return`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 ${$} ${J}" width="${$}" height="${J}" style="${Z}${Q?"":";background:var(--bg)"}">`}function u6($){let J=$.split(`
`).map((Q)=>Q.trim()).filter((Q)=>Q.length>0&&!Q.startsWith("%%"));if(J.length===0)throw Error("Empty mermaid diagram");let K=J[0];if(/^stateDiagram(-v2)?\s*$/i.test(K))return F7(J);return G7(J)}function G7($){let J=$[0].match(/^(?:graph|flowchart)\s+(TD|TB|LR|BT|RL)\s*$/i);if(!J)throw Error(`Invalid mermaid header: "${$[0]}". Expected "graph TD", "flowchart LR", "stateDiagram-v2", etc.`);let Q={direction:J[1].toUpperCase(),nodes:new Map,edges:[],subgraphs:[],classDefs:new Map,classAssignments:new Map,nodeStyles:new Map},Z=[];for(let z=1;z<$.length;z++){let B=$[z],U=B.match(/^classDef\s+(\w+)\s+(.+)$/);if(U){let V=U[1],P=U[2],W=X6(P);Q.classDefs.set(V,W);continue}let j=B.match(/^class\s+([\w,-]+)\s+(\w+)$/);if(j){let V=j[1].split(",").map((W)=>W.trim()),P=j[2];for(let W of V)Q.classAssignments.set(W,P);continue}let _=B.match(/^style\s+([\w,-]+)\s+(.+)$/);if(_){let V=_[1].split(",").map((W)=>W.trim()),P=X6(_[2]);for(let W of V)Q.nodeStyles.set(W,{...Q.nodeStyles.get(W),...P});continue}let F=B.match(/^direction\s+(TD|TB|LR|BT|RL)\s*$/i);if(F&&Z.length>0){Z[Z.length-1].direction=F[1].toUpperCase();continue}let H=B.match(/^subgraph\s+(.+)$/);if(H){let V=H[1].trim(),P=V.match(/^([\w-]+)\s*\[(.+)\]$/),W,G;if(P)W=P[1],G=P[2];else G=V,W=V.replace(/\s+/g,"_").replace(/[^\w]/g,"");let R={id:W,label:G,nodeIds:[],children:[]};Z.push(R);continue}if(B==="end"){let V=Z.pop();if(V)if(Z.length>0)Z[Z.length-1].children.push(V);else Q.subgraphs.push(V);continue}R7(B,Q,Z)}return Q}function F7($){let J={direction:"TD",nodes:new Map,edges:[],subgraphs:[],classDefs:new Map,classAssignments:new Map,nodeStyles:new Map},K=[],Q=0,Z=0;for(let z=1;z<$.length;z++){let B=$[z],U=B.match(/^direction\s+(TD|TB|LR|BT|RL)\s*$/i);if(U){if(K.length>0)K[K.length-1].direction=U[1].toUpperCase();else J.direction=U[1].toUpperCase();continue}let j=B.match(/^state\s+(?:"([^"]+)"\s+as\s+)?(\w+)\s*\{$/);if(j){let V=j[1]??j[2],W={id:j[2],label:V,nodeIds:[],children:[]};K.push(W);continue}if(B==="}"){let V=K.pop();if(V)if(K.length>0)K[K.length-1].children.push(V);else J.subgraphs.push(V);continue}let _=B.match(/^state\s+"([^"]+)"\s+as\s+(\w+)\s*$/);if(_){let V=_[1],P=_[2];x0(J,K,{id:P,label:V,shape:"rounded"});continue}let F=B.match(/^(\[\*\]|[\w-]+)\s*(-->)\s*(\[\*\]|[\w-]+)(?:\s*:\s*(.+))?$/);if(F){let V=F[1],P=F[3],W=F[4]?.trim()||void 0;if(V==="[*]")Q++,V=`_start${Q>1?Q:""}`,x0(J,K,{id:V,label:"",shape:"state-start"});else O6(J,K,V);if(P==="[*]")Z++,P=`_end${Z>1?Z:""}`,x0(J,K,{id:P,label:"",shape:"state-end"});else O6(J,K,P);J.edges.push({source:V,target:P,label:W,style:"solid",hasArrowStart:!1,hasArrowEnd:!0});continue}let H=B.match(/^([\w-]+)\s*:\s*(.+)$/);if(H){let V=H[1],P=H[2].trim();x0(J,K,{id:V,label:P,shape:"rounded"});continue}}return J}function x0($,J,K){if(!$.nodes.has(K.id))$.nodes.set(K.id,K);if(J.length>0){let Z=J[J.length-1];if(!Z.nodeIds.includes(K.id))Z.nodeIds.push(K.id)}}function O6($,J,K){if(!$.nodes.has(K))x0($,J,{id:K,label:K,shape:"rounded"});else if(J.length>0){let Q=J[J.length-1];if(!Q.nodeIds.includes(K))Q.nodeIds.push(K)}}function X6($){let J={};for(let K of $.split(",")){let Q=K.indexOf(":");if(Q>0){let Z=K.slice(0,Q).trim(),z=K.slice(Q+1).trim();if(Z&&z)J[Z]=z}}return J}var P7=/^(<)?(-->|-.->|==>|---|-\.-|===)(?:\|([^|]*)\|)?/,H7=[{regex:/^([\w-]+)\(\(\((.+?)\)\)\)/,shape:"doublecircle"},{regex:/^([\w-]+)\(\[(.+?)\]\)/,shape:"stadium"},{regex:/^([\w-]+)\(\((.+?)\)\)/,shape:"circle"},{regex:/^([\w-]+)\[\[(.+?)\]\]/,shape:"subroutine"},{regex:/^([\w-]+)\[\((.+?)\)\]/,shape:"cylinder"},{regex:/^([\w-]+)\[\/(.+?)\\\]/,shape:"trapezoid"},{regex:/^([\w-]+)\[\\(.+?)\/\]/,shape:"trapezoid-alt"},{regex:/^([\w-]+)>(.+?)\]/,shape:"asymmetric"},{regex:/^([\w-]+)\{\{(.+?)\}\}/,shape:"hexagon"},{regex:/^([\w-]+)\[(.+?)\]/,shape:"rectangle"},{regex:/^([\w-]+)\((.+?)\)/,shape:"rounded"},{regex:/^([\w-]+)\{(.+?)\}/,shape:"diamond"}],W7=/^([\w-]+)/,M7=/^:::([\w][\w-]*)/;function R7($,J,K){let Q=$.trim(),Z=D6(Q,J,K);if(!Z||Z.ids.length===0)return;Q=Z.remaining.trim();let z=Z.ids;while(Q.length>0){let B=Q.match(P7);if(!B)break;let U=Boolean(B[1]),j=B[2],_=B[3]?.trim()||void 0;Q=Q.slice(B[0].length).trim();let F=q7(j),H=j.endsWith(">"),V=D6(Q,J,K);if(!V||V.ids.length===0)break;Q=V.remaining.trim();for(let P of z)for(let W of V.ids)J.edges.push({source:P,target:W,label:_,style:F,hasArrowStart:U,hasArrowEnd:H});z=V.ids}}function D6($,J,K){let Q=C6($,J,K);if(!Q)return null;let Z=[Q.id],z=Q.remaining.trim();while(z.startsWith("&")){z=z.slice(1).trim();let B=C6(z,J,K);if(!B)break;Z.push(B.id),z=B.remaining.trim()}return{ids:Z,remaining:z}}function C6($,J,K){let Q=null,Z=$;for(let{regex:B,shape:U}of H7){let j=$.match(B);if(j){Q=j[1];let _=j[2];I6(J,K,{id:Q,label:_,shape:U}),Z=$.slice(j[0].length);break}}if(Q===null){let B=$.match(W7);if(B){if(Q=B[1],!J.nodes.has(Q))I6(J,K,{id:Q,label:Q,shape:"rectangle"});else m6(K,Q);Z=$.slice(B[0].length)}}if(Q===null)return null;let z=Z.match(M7);if(z)J.classAssignments.set(Q,z[1]),Z=Z.slice(z[0].length);return{id:Q,remaining:Z}}function I6($,J,K){if(!$.nodes.has(K.id))$.nodes.set(K.id,K);m6(J,K.id)}function m6($,J){if($.length>0){let K=$[$.length-1];if(!K.nodeIds.includes(J))K.nodeIds.push(J)}}function q7($){if($==="-.->")return"dotted";if($==="-.-")return"dotted";if($==="==>")return"thick";if($==="===")return"thick";return"solid"}var U0={x:1,y:0},J0={x:1,y:2},V0={x:0,y:1},Q0={x:2,y:1},D0={x:2,y:0},q0={x:0,y:0},I0={x:2,y:2},C0={x:0,y:2},h6={x:1,y:1};function L6($,J){return $.x===J.x&&$.y===J.y}function Y7($,J){return $.x===J.x&&$.y===J.y}function p0($,J){return{x:$.x+J.x,y:$.y+J.y}}function O0($){return`${$.x},${$.y}`}var A7={name:"",styles:{}};function P0($,J){let K=[];for(let Q=0;Q<=$;Q++){let Z=[];for(let z=0;z<=J;z++)Z.push(" ");K.push(Z)}return K}function S0($){let[J,K]=u0($);return P0(J,K)}function u0($){return[$.length-1,($[0]?.length??1)-1]}function c0($,J,K){let[Q,Z]=u0($),z=Math.max(J,Q),B=Math.max(K,Z),U=P0(z,B);for(let j=0;j<U.length;j++)for(let _=0;_<U[0].length;_++)if(j<$.length&&_<$[0].length)U[j][_]=$[j][_];return $.length=0,$.push(...U),$}var O7=new Set(["","","","","","","","","","","","","","",""]);function T6($){return O7.has($)}var X7={"":{"":"","":"","":"","":"","":"","":"","":"","":"","":""},"":{"":"","":"","":"","":"","":"","":"","":"","":"","":""},"":{"":"","":"","":"","":"","":"","":"","":"","":"","":""},"":{"":"","":"","":"","":"","":"","":"","":"","":"","":""},"":{"":"","":"","":"","":"","":"","":"","":"","":"","":""},"":{"":"","":"","":"","":"","":"","":"","":"","":"","":""},"":{"":"","":"","":"","":"","":"","":"","":"","":"","":""},"":{"":"","":"","":"","":"","":"","":"","":"","":"","":""},"":{"":"","":"","":"","":"","":"","":"","":"","":"","":""},"":{"":"","":"","":"","":"","":"","":"","":"","":"","":""}};function D7($,J){return X7[$]?.[J]??$}function A0($,J,K,...Q){let[Z,z]=u0($);for(let U of Q){let[j,_]=u0(U);Z=Math.max(Z,j+J.x),z=Math.max(z,_+J.y)}let B=P0(Z,z);for(let U=0;U<=Z;U++)for(let j=0;j<=z;j++)if(U<$.length&&j<$[0].length)B[U][j]=$[U][j];for(let U of Q)for(let j=0;j<U.length;j++)for(let _=0;_<U[0].length;_++){let F=U[j][_];if(F!==" "){let H=j+J.x,V=_+J.y,P=B[H][V];if(!K&&T6(F)&&T6(P))B[H][V]=D7(P,F);else B[H][V]=F}}return B}function $6($){let[J,K]=u0($),Q=[];for(let Z=0;Z<=K;Z++){let z="";for(let B=0;B<=J;B++)z+=$[B][Z];Q.push(z)}return Q.join(`
`)}var C7={"":"","":"","":"","":"","":"","":"","^":"v",v:"^","":"","":"","":"","":"","":"","":"","":"","":""};function I7($){for(let J of $)J.reverse();for(let J of $)for(let K=0;K<J.length;K++){let Q=C7[J[K]];if(Q)J[K]=Q}return $}function L7($,J,K){c0($,J.x+K.length,J.y);for(let Q=0;Q<K.length;Q++)$[J.x+Q][J.y]=K[Q]}function T7($,J,K){let Q=0,Z=0;for(let z of J.values())Q+=z;for(let z of K.values())Z+=z;c0($,Q-1,Z-1)}function E7($,J){let K=new Map,Q=0;for(let[U,j]of $.nodes){let _={name:U,displayLabel:j.label,index:Q,gridCoord:null,drawingCoord:null,drawing:null,drawn:!1,styleClassName:"",styleClass:A7};K.set(U,_),Q++}let Z=[...K.values()],z=[];for(let U of $.edges){let j=K.get(U.source),_=K.get(U.target);if(!j||!_)continue;z.push({from:j,to:_,text:U.label??"",path:[],labelLine:[],startDir:{x:0,y:0},endDir:{x:0,y:0}})}let B=[];for(let U of $.subgraphs)c6(U,null,K,B);N7($.subgraphs,B,K);for(let[U,j]of $.classAssignments){let _=K.get(U),F=$.classDefs.get(j);if(_&&F)_.styleClassName=j,_.styleClass={name:j,styles:F}}return{nodes:Z,edges:z,canvas:P0(0,0),grid:new Map,columnWidth:new Map,rowHeight:new Map,subgraphs:B,config:J,offsetX:0,offsetY:0}}function c6($,J,K,Q){let Z={name:$.label,nodes:[],parent:J,children:[],minX:0,minY:0,maxX:0,maxY:0};for(let z of $.nodeIds){let B=K.get(z);if(B)Z.nodes.push(B)}Q.push(Z);for(let z of $.children){let B=c6(z,Z,K,Q);Z.children.push(B);for(let U of B.nodes)if(!Z.nodes.includes(U))Z.nodes.push(U)}return Z}function N7($,J,K,Q){let Z=new Map;S7($,J,Z);let z=new Map;function B(U){let j=Z.get(U);if(!j)return;for(let _ of U.children)B(_);for(let _ of U.nodeIds)if(!z.has(_))z.set(_,j)}for(let U of $)B(U);for(let U of J)U.nodes=U.nodes.filter((j)=>{let _;for(let[H,V]of K)if(V===j){_=H;break}if(!_)return!1;let F=z.get(_);if(!F)return!0;return k7(U,F)})}function k7($,J){let K=J;while(K!==null){if(K===$)return!0;K=K.parent}return!1}function S7($,J,K){let Q=[];function Z(z){for(let B of z)Q.push(B),Z(B.children)}Z($);for(let z=0;z<Q.length&&z<J.length;z++)K.set(Q[z],J[z])}var w7=class{items=[];get length(){return this.items.length}push($){this.items.push($),this.bubbleUp(this.items.length-1)}pop(){if(this.items.length===0)return;let $=this.items[0],J=this.items.pop();if(this.items.length>0)this.items[0]=J,this.sinkDown(0);return $}bubbleUp($){while($>0){let J=$-1>>1;if(this.items[$].priority<this.items[J].priority)[this.items[$],this.items[J]]=[this.items[J],this.items[$]],$=J;else break}}sinkDown($){let J=this.items.length;while(!0){let K=$,Q=2*$+1,Z=2*$+2;if(Q<J&&this.items[Q].priority<this.items[K].priority)K=Q;if(Z<J&&this.items[Z].priority<this.items[K].priority)K=Z;if(K!==$)[this.items[$],this.items[K]]=[this.items[K],this.items[$]],$=K;else break}}};function f7($,J){let K=Math.abs($.x-J.x),Q=Math.abs($.y-J.y);if(K===0||Q===0)return K+Q;return K+Q+1}var b7=[{x:1,y:0},{x:-1,y:0},{x:0,y:1},{x:0,y:-1}];function y7($,J){if(J.x<0||J.y<0)return!1;return!$.has(O0(J))}function E6($,J,K){let Q=new w7;Q.push({coord:J,priority:0});let Z=new Map;Z.set(O0(J),0);let z=new Map;z.set(O0(J),null);while(Q.length>0){let B=Q.pop().coord;if(L6(B,K)){let j=[],_=B;while(_!==null)j.unshift(_),_=z.get(O0(_))??null;return j}let U=Z.get(O0(B));for(let j of b7){let _={x:B.x+j.x,y:B.y+j.y};if(!y7($,_)&&!L6(_,K))continue;let F=U+1,H=O0(_),V=Z.get(H);if(V===void 0||F<V){Z.set(H,F);let P=F+f7(_,K);Q.push({coord:_,priority:P}),z.set(H,B)}}}return null}function N6($){if($.length<=2)return $;let J=new Set,K=$[0],Q=$[1];for(let Z=2;Z<$.length;Z++){let z=$[Z],B=Q.x-K.x,U=Q.y-K.y,j=z.x-Q.x,_=z.y-Q.y;if(B===j&&U===_)J.add(Z-1);K=Q,Q=z}return $.filter((Z,z)=>!J.has(z))}function l0($){if($===U0)return J0;if($===J0)return U0;if($===V0)return Q0;if($===Q0)return V0;if($===D0)return C0;if($===q0)return I0;if($===I0)return q0;if($===C0)return D0;return h6}function i($,J){return $.x===J.x&&$.y===J.y}function L0($,J){if($.x===J.x)return $.y<J.y?J0:U0;else if($.y===J.y)return $.x<J.x?Q0:V0;else if($.x<J.x)return $.y<J.y?I0:D0;else return $.y<J.y?C0:q0}function x7($){if($==="LR")return[Q0,J0,J0,Q0];return[J0,Q0,Q0,J0]}function v7($,J){if($.from===$.to)return x7(J);let K=L0($.from.gridCoord,$.to.gridCoord),Q,Z,z,B,U=J==="LR"?i(K,V0)||i(K,q0)||i(K,C0):i(K,U0)||i(K,q0)||i(K,D0);if(i(K,I0))if(J==="LR")Q=J0,Z=V0,z=Q0,B=U0;else Q=Q0,Z=U0,z=J0,B=V0;else if(i(K,D0))if(J==="LR")Q=U0,Z=V0,z=Q0,B=J0;else Q=Q0,Z=J0,z=U0,B=V0;else if(i(K,C0))if(J==="LR")Q=J0,Z=J0,z=V0,B=U0;else Q=V0,Z=U0,z=J0,B=Q0;else if(i(K,q0))if(J==="LR")Q=J0,Z=J0,z=V0,B=J0;else Q=Q0,Z=Q0,z=U0,B=Q0;else if(U)if(J==="LR"&&i(K,V0))Q=J0,Z=J0,z=V0,B=Q0;else if(J==="TD"&&i(K,U0))Q=Q0,Z=Q0,z=U0,B=J0;else Q=K,Z=l0(K),z=K,B=l0(K);else Q=K,Z=l0(K),z=K,B=l0(K);return[Q,Z,z,B]}function u7($,J){let[K,Q,Z,z]=v7(J,$.config.graphDirection),B=p0(J.from.gridCoord,K),U=p0(J.to.gridCoord,Q),j=E6($.grid,B,U);if(j===null){J.startDir=Z,J.endDir=z,J.path=[];return}j=N6(j);let _=p0(J.from.gridCoord,Z),F=p0(J.to.gridCoord,z),H=E6($.grid,_,F);if(H===null){J.startDir=K,J.endDir=Q,J.path=j;return}if(H=N6(H),j.length<=H.length)J.startDir=K,J.endDir=Q,J.path=j;else J.startDir=Z,J.endDir=z,J.path=H}function m7($,J){if(J.text.length===0)return;let K=J.text.length,Q=J.path[0],Z=[Q,J.path[1]],z=0;for(let F=1;F<J.path.length;F++){let H=J.path[F],V=[Q,H],P=h7($,V);if(P>=K){Z=V;break}else if(P>z)z=P,Z=V;Q=H}let B=Math.min(Z[0].x,Z[1].x),U=Math.max(Z[0].x,Z[1].x),j=B+Math.floor((U-B)/2),_=$.columnWidth.get(j)??0;$.columnWidth.set(j,Math.max(_,K+2)),J.labelLine=[Z[0],Z[1]]}function h7($,J){let K=0,Q=Math.min(J[0].x,J[1].x),Z=Math.max(J[0].x,J[1].x);for(let z=Q;z<=Z;z++)K+=$.columnWidth.get(z)??0;return K}function c7($,J){let K=$.gridCoord,Q=J.config.useAscii,Z=0;for(let V=0;V<2;V++)Z+=J.columnWidth.get(K.x+V)??0;let z=0;for(let V=0;V<2;V++)z+=J.rowHeight.get(K.y+V)??0;let B={x:0,y:0},U={x:Z,y:z},j=P0(Math.max(B.x,U.x),Math.max(B.y,U.y));if(!Q){for(let V=B.x+1;V<U.x;V++)j[V][B.y]="";for(let V=B.x+1;V<U.x;V++)j[V][U.y]="";for(let V=B.y+1;V<U.y;V++)j[B.x][V]="";for(let V=B.y+1;V<U.y;V++)j[U.x][V]="";j[B.x][B.y]="",j[U.x][B.y]="",j[B.x][U.y]="",j[U.x][U.y]=""}else{for(let V=B.x+1;V<U.x;V++)j[V][B.y]="-";for(let V=B.x+1;V<U.x;V++)j[V][U.y]="-";for(let V=B.y+1;V<U.y;V++)j[B.x][V]="|";for(let V=B.y+1;V<U.y;V++)j[U.x][V]="|";j[B.x][B.y]="+",j[U.x][B.y]="+",j[B.x][U.y]="+",j[U.x][U.y]="+"}let _=$.displayLabel,F=B.y+Math.floor(z/2),H=B.x+Math.floor(Z/2)-Math.ceil(_.length/2)+1;for(let V=0;V<_.length;V++)j[H+V][F]=_[V];return j}function p6($,J,K=1){let Q=0;for(let D of $)for(let I of D)Q=Math.max(Q,I.length);let z=Q+2*K+2,B=0;for(let D of $)B+=Math.max(D.length,1);let U=$.length-1,j=B+U+2,_=J?"-":"",F=J?"|":"",H=J?"+":"",V=J?"+":"",P=J?"+":"",W=J?"+":"",G=J?"+":"",R=J?"+":"",M=P0(z-1,j-1);M[0][0]=H;for(let D=1;D<z-1;D++)M[D][0]=_;M[z-1][0]=V,M[0][j-1]=P;for(let D=1;D<z-1;D++)M[D][j-1]=_;M[z-1][j-1]=W;for(let D=1;D<j-1;D++)M[0][D]=F,M[z-1][D]=F;let q=1;for(let D=0;D<$.length;D++){let I=$[D],x=I.length>0?I:[""];for(let Y of x){let A=1+K;for(let O=0;O<Y.length;O++)M[A+O][q]=Y[O];q++}if(D<$.length-1){M[0][q]=G;for(let Y=1;Y<z-1;Y++)M[Y][q]=_;M[z-1][q]=R,q++}}return M}function p7($,J,K,Q,Z,z){let B=L0(J,K),U=[],j=z?"-":"",_=z?"|":"",F=z?"\\":"",H=z?"/":"";if(i(B,U0))for(let V=J.y-Q;V>=K.y-Z;V--)U.push({x:J.x,y:V}),$[J.x][V]=_;else if(i(B,J0))for(let V=J.y+Q;V<=K.y+Z;V++)U.push({x:J.x,y:V}),$[J.x][V]=_;else if(i(B,V0))for(let V=J.x-Q;V>=K.x-Z;V--)U.push({x:V,y:J.y}),$[V][J.y]=j;else if(i(B,Q0))for(let V=J.x+Q;V<=K.x+Z;V++)U.push({x:V,y:J.y}),$[V][J.y]=j;else if(i(B,q0))for(let V=J.x,P=J.y-Q;V>=K.x-Z&&P>=K.y-Z;V--,P--)U.push({x:V,y:P}),$[V][P]=F;else if(i(B,D0))for(let V=J.x,P=J.y-Q;V<=K.x+Z&&P>=K.y-Z;V++,P--)U.push({x:V,y:P}),$[V][P]=H;else if(i(B,C0))for(let V=J.x,P=J.y+Q;V>=K.x-Z&&P<=K.y+Z;V--,P++)U.push({x:V,y:P}),$[V][P]=H;else if(i(B,I0))for(let V=J.x,P=J.y+Q;V<=K.x+Z&&P<=K.y+Z;V++,P++)U.push({x:V,y:P}),$[V][P]=F;return U}function l7($,J){if(J.path.length===0){let _=S0($.canvas);return[_,_,_,_,_]}let K=s7($,J),[Q,Z,z]=d7($,J.path),B=n7($,J.path,Z[0]),U=g7($,Z[Z.length-1],z[z.length-1]),j=o7($,J.path);return[Q,B,U,j,K]}function d7($,J){let K=S0($.canvas),Q=J[0],Z=[],z=[];for(let B=1;B<J.length;B++){let U=J[B],j=m0($,Q),_=m0($,U);if(Y7(j,_)){Q=U;continue}let F=L0(Q,U),H=p7(K,j,_,1,-1,$.config.useAscii);if(H.length===0)H.push(j);Z.push(H),z.push(F),Q=U}return[K,Z,z]}function n7($,J,K){let Q=S0($.canvas);if($.config.useAscii)return Q;let Z=K[0],z=L0(J[0],J[1]);if(i(z,U0))Q[Z.x][Z.y+1]="";else if(i(z,J0))Q[Z.x][Z.y-1]="";else if(i(z,V0))Q[Z.x+1][Z.y]="";else if(i(z,Q0))Q[Z.x-1][Z.y]="";return Q}function g7($,J,K){let Q=S0($.canvas);if(J.length===0)return Q;let Z=J[0],z=J[J.length-1],B=L0(Z,z);if(J.length===1||i(B,h6))B=K;let U;if(!$.config.useAscii)if(i(B,U0))U="";else if(i(B,J0))U="";else if(i(B,V0))U="";else if(i(B,Q0))U="";else if(i(B,D0))U="";else if(i(B,q0))U="";else if(i(B,I0))U="";else if(i(B,C0))U="";else if(i(K,U0))U="";else if(i(K,J0))U="";else if(i(K,V0))U="";else if(i(K,Q0))U="";else if(i(K,D0))U="";else if(i(K,q0))U="";else if(i(K,I0))U="";else if(i(K,C0))U="";else U="";else if(i(B,U0))U="^";else if(i(B,J0))U="v";else if(i(B,V0))U="<";else if(i(B,Q0))U=">";else if(i(K,U0))U="^";else if(i(K,J0))U="v";else if(i(K,V0))U="<";else if(i(K,Q0))U=">";else U="*";return Q[z.x][z.y]=U,Q}function o7($,J){let K=S0($.canvas);for(let Q=1;Q<J.length-1;Q++){let Z=J[Q],z=m0($,Z),B=L0(J[Q-1],Z),U=L0(Z,J[Q+1]),j;if(!$.config.useAscii)if(i(B,Q0)&&i(U,J0)||i(B,U0)&&i(U,V0))j="";else if(i(B,Q0)&&i(U,U0)||i(B,J0)&&i(U,V0))j="";else if(i(B,V0)&&i(U,J0)||i(B,U0)&&i(U,Q0))j="";else if(i(B,V0)&&i(U,U0)||i(B,J0)&&i(U,Q0))j="";else j="+";else j="+";K[z.x][z.y]=j}return K}function s7($,J){let K=S0($.canvas);if(J.text.length===0)return K;let Q=$8($,J.labelLine);return i7(K,Q,J.text),K}function i7($,J,K){if(J.length<2)return;let Q=Math.min(J[0].x,J[1].x),Z=Math.max(J[0].x,J[1].x),z=Math.min(J[0].y,J[1].y),B=Math.max(J[0].y,J[1].y),U=Q+Math.floor((Z-Q)/2),j=z+Math.floor((B-z)/2),_=U-Math.floor(K.length/2);L7($,{x:_,y:j},K)}function a7($,J){let K=$.maxX-$.minX,Q=$.maxY-$.minY;if(K<=0||Q<=0)return P0(0,0);let Z={x:0,y:0},z={x:K,y:Q},B=P0(K,Q);if(!J.config.useAscii){for(let U=Z.x+1;U<z.x;U++)B[U][Z.y]="";for(let U=Z.x+1;U<z.x;U++)B[U][z.y]="";for(let U=Z.y+1;U<z.y;U++)B[Z.x][U]="";for(let U=Z.y+1;U<z.y;U++)B[z.x][U]="";B[Z.x][Z.y]="",B[z.x][Z.y]="",B[Z.x][z.y]="",B[z.x][z.y]=""}else{for(let U=Z.x+1;U<z.x;U++)B[U][Z.y]="-";for(let U=Z.x+1;U<z.x;U++)B[U][z.y]="-";for(let U=Z.y+1;U<z.y;U++)B[Z.x][U]="|";for(let U=Z.y+1;U<z.y;U++)B[z.x][U]="|";B[Z.x][Z.y]="+",B[z.x][Z.y]="+",B[Z.x][z.y]="+",B[z.x][z.y]="+"}return B}function t7($,J){let K=$.maxX-$.minX,Q=$.maxY-$.minY;if(K<=0||Q<=0)return[P0(0,0),{x:0,y:0}];let Z=P0(K,Q),z=1,B=Math.floor(K/2)-Math.floor($.name.length/2);if(B<1)B=1;for(let U=0;U<$.name.length;U++)if(B+U<K)Z[B+U][z]=$.name[U];return[Z,{x:$.minX,y:$.minY}]}function r7($){function J(Q){return Q.parent===null?0:1+J(Q.parent)}let K=[...$];return K.sort((Q,Z)=>J(Q)-J(Z)),K}function e7($){let J=$.config.useAscii,K=r7($.subgraphs);for(let _ of K){let F=a7(_,$),H={x:_.minX,y:_.minY};$.canvas=A0($.canvas,H,J,F)}for(let _ of $.nodes)if(!_.drawn&&_.drawingCoord&&_.drawing)$.canvas=A0($.canvas,_.drawingCoord,J,_.drawing),_.drawn=!0;let Q=[],Z=[],z=[],B=[],U=[];for(let _ of $.edges){let[F,H,V,P,W]=l7($,_);Q.push(F),Z.push(P),z.push(V),B.push(H),U.push(W)}let j={x:0,y:0};$.canvas=A0($.canvas,j,J,...Q),$.canvas=A0($.canvas,j,J,...Z),$.canvas=A0($.canvas,j,J,...z),$.canvas=A0($.canvas,j,J,...B),$.canvas=A0($.canvas,j,J,...U);for(let _ of $.subgraphs){if(_.nodes.length===0)continue;let[F,H]=t7(_);$.canvas=A0($.canvas,H,J,F)}return $.canvas}function m0($,J,K){let Q=J,Z=0;for(let j=0;j<Q.x;j++)Z+=$.columnWidth.get(j)??0;let z=0;for(let j=0;j<Q.y;j++)z+=$.rowHeight.get(j)??0;let B=$.columnWidth.get(Q.x)??0,U=$.rowHeight.get(Q.y)??0;return{x:Z+Math.floor(B/2)+$.offsetX,y:z+Math.floor(U/2)+$.offsetY}}function $8($,J){return J.map((K)=>m0($,K))}function v0($,J,K){if($.grid.has(O0(K)))if($.config.graphDirection==="LR")return v0($,J,{x:K.x,y:K.y+4});else return v0($,J,{x:K.x+4,y:K.y});for(let Q=0;Q<3;Q++)for(let Z=0;Z<3;Z++){let z={x:K.x+Q,y:K.y+Z};$.grid.set(O0(z),J)}return J.gridCoord=K,K}function J8($,J){let K=J.gridCoord,Q=$.config.boxBorderPadding,Z=[1,2*Q+J.displayLabel.length,1],z=[1,1+2*Q,1];for(let B=0;B<Z.length;B++){let U=K.x+B,j=$.columnWidth.get(U)??0;$.columnWidth.set(U,Math.max(j,Z[B]))}for(let B=0;B<z.length;B++){let U=K.y+B,j=$.rowHeight.get(U)??0;$.rowHeight.set(U,Math.max(j,z[B]))}if(K.x>0){let B=$.columnWidth.get(K.x-1)??0;$.columnWidth.set(K.x-1,Math.max(B,$.config.paddingX))}if(K.y>0){let B=$.config.paddingY;if(K8($,J))B+=4;let U=$.rowHeight.get(K.y-1)??0;$.rowHeight.set(K.y-1,Math.max(U,B))}}function Q8($,J){for(let K of J){if(!$.columnWidth.has(K.x))$.columnWidth.set(K.x,Math.floor($.config.paddingX/2));if(!$.rowHeight.has(K.y))$.rowHeight.set(K.y,Math.floor($.config.paddingY/2))}}function K6($,J){return $.subgraphs.some((K)=>K.nodes.includes(J))}function Z6($,J){for(let K of $.subgraphs)if(K.nodes.includes(J))return K;return null}function K8($,J){let K=Z6($,J);if(!K)return!1;let Q=!1;for(let Z of $.edges)if(Z.to===J){if(Z6($,Z.from)!==K){Q=!0;break}}if(!Q)return!1;for(let Z of K.nodes){if(Z===J||!Z.gridCoord)continue;let z=!1;for(let B of $.edges)if(B.to===Z){if(Z6($,B.from)!==K){z=!0;break}}if(z&&Z.gridCoord.y<J.gridCoord.y)return!1}return!0}function l6($,J){if(J.nodes.length===0)return;let K=1e6,Q=1e6,Z=-1e6,z=-1e6;for(let j of J.children)if(l6($,j),j.nodes.length>0)K=Math.min(K,j.minX),Q=Math.min(Q,j.minY),Z=Math.max(Z,j.maxX),z=Math.max(z,j.maxY);for(let j of J.nodes){if(!j.drawingCoord||!j.drawing)continue;let _=j.drawingCoord.x,F=j.drawingCoord.y,H=_+j.drawing.length-1,V=F+j.drawing[0].length-1;K=Math.min(K,_),Q=Math.min(Q,F),Z=Math.max(Z,H),z=Math.max(z,V)}let B=2,U=2;J.minX=K-B,J.minY=Q-B-U,J.maxX=Z+B,J.maxY=z+B}function Z8($){let K=$.subgraphs.filter((Q)=>Q.parent===null&&Q.nodes.length>0);for(let Q=0;Q<K.length;Q++)for(let Z=Q+1;Z<K.length;Z++){let z=K[Q],B=K[Z];if(z.minX<B.maxX&&z.maxX>B.minX){if(z.maxY>=B.minY-1&&z.minY<B.minY)B.minY=z.maxY+1+1;else if(B.maxY>=z.minY-1&&B.minY<z.minY)z.minY=B.maxY+1+1}if(z.minY<B.maxY&&z.maxY>B.minY){if(z.maxX>=B.minX-1&&z.minX<B.minX)B.minX=z.maxX+1+1;else if(B.maxX>=z.minX-1&&B.minX<z.minX)z.minX=B.maxX+1+1}}}function U8($){for(let J of $.subgraphs)l6($,J);Z8($)}function V8($){if($.subgraphs.length===0)return;let J=0,K=0;for(let z of $.subgraphs)J=Math.min(J,z.minX),K=Math.min(K,z.minY);let Q=-J,Z=-K;if(Q===0&&Z===0)return;$.offsetX=Q,$.offsetY=Z;for(let z of $.subgraphs)z.minX+=Q,z.minY+=Z,z.maxX+=Q,z.maxY+=Z;for(let z of $.nodes)if(z.drawingCoord)z.drawingCoord.x+=Q,z.drawingCoord.y+=Z}function z8($){let J=$.config.graphDirection,K=Array(100).fill(0),Q=new Set,Z=[];for(let F of $.nodes){if(!Q.has(F.name))Z.push(F);Q.add(F.name);for(let H of U6($,F))Q.add(H.name)}let z=!1,B=!1;for(let F of Z)if(K6($,F)){if(U6($,F).length>0)B=!0}else z=!0;let U=J==="LR"&&z&&B,j,_=[];if(U)j=Z.filter((F)=>!K6($,F)),_=Z.filter((F)=>K6($,F));else j=Z;for(let F of j){let H=J==="LR"?{x:0,y:K[0]}:{x:K[0],y:0};v0($,$.nodes[F.index],H),K[0]=K[0]+4}if(U&&_.length>0)for(let H of _){let V=J==="LR"?{x:4,y:K[4]}:{x:K[4],y:4};v0($,$.nodes[H.index],V),K[4]=K[4]+4}for(let F of $.nodes){let H=F.gridCoord,V=J==="LR"?H.x+4:H.y+4,P=K[V];for(let W of U6($,F)){if(W.gridCoord!==null)continue;let G=J==="LR"?{x:V,y:P}:{x:P,y:V};v0($,$.nodes[W.index],G),K[V]=P+4,P=K[V]}}for(let F of $.nodes)J8($,F);for(let F of $.edges)u7($,F),Q8($,F.path),m7($,F);for(let F of $.nodes)F.drawingCoord=m0($,F.gridCoord),F.drawing=c7(F,$);T7($.canvas,$.columnWidth,$.rowHeight),U8($),V8($)}function B8($,J){return $.edges.filter((K)=>K.from.name===J.name)}function U6($,J){return B8($,J).map((K)=>K.to)}function d6($){let J={actors:[],messages:[],blocks:[],notes:[]},K=new Set,Q=[];for(let Z=1;Z<$.length;Z++){let z=$[Z],B=z.match(/^(participant|actor)\s+(\S+?)(?:\s+as\s+(.+))?$/);if(B){let V=B[1],P=B[2],W=B[3]?.trim()??P;if(!K.has(P))K.add(P),J.actors.push({id:P,label:W,type:V});continue}let U=z.match(/^Note\s+(left of|right of|over)\s+([^:]+):\s*(.+)$/i);if(U){let V=U[1].toLowerCase(),P=U[2].trim(),W=U[3].trim(),G=P.split(",").map((M)=>M.trim());for(let M of G)b0(J,K,M);let R="over";if(V==="left of")R="left";else if(V==="right of")R="right";J.notes.push({actorIds:G,text:W,position:R,afterIndex:J.messages.length-1});continue}let j=z.match(/^(loop|alt|opt|par|critical|break|rect)\s*(.*)$/);if(j){let V=j[1],P=j[2]?.trim()??"";Q.push({type:V,label:P,startIndex:J.messages.length,dividers:[]});continue}let _=z.match(/^(else|and)\s*(.*)$/);if(_&&Q.length>0){let V=_[2]?.trim()??"";Q[Q.length-1].dividers.push({index:J.messages.length,label:V});continue}if(z==="end"&&Q.length>0){let V=Q.pop();J.blocks.push({type:V.type,label:V.label,startIndex:V.startIndex,endIndex:Math.max(J.messages.length-1,V.startIndex),dividers:V.dividers});continue}let F=z.match(/^(\S+?)\s*(--?>?>|--?[)x]|--?>>|--?>)\s*([+-]?)(\S+?)\s*:\s*(.+)$/);if(F){let V=F[1],P=F[2],W=F[3],G=F[4],R=F[5].trim();b0(J,K,V),b0(J,K,G);let M=P.startsWith("--")?"dashed":"solid",q=P.includes(">>")||P.includes("x")?"filled":"open",D={from:V,to:G,label:R,lineStyle:M,arrowHead:q};if(W==="+")D.activate=!0;if(W==="-")D.deactivate=!0;J.messages.push(D);continue}let H=z.match(/^(\S+?)\s*(->>|-->>|-\)|--\)|-x|--x|->|-->)\s*([+-]?)(\S+?)\s*:\s*(.+)$/);if(H){let V=H[1],P=H[2],W=H[3],G=H[4],R=H[5].trim();b0(J,K,V),b0(J,K,G);let M=P.startsWith("--")?"dashed":"solid",q=P.includes(">>")||P.includes("x")?"filled":"open",D={from:V,to:G,label:R,lineStyle:M,arrowHead:q};if(W==="+")D.activate=!0;if(W==="-")D.deactivate=!0;J.messages.push(D);continue}}return J}function b0($,J,K){if(!J.has(K))J.add(K),$.actors.push({id:K,label:K,type:"participant"})}function j8($,J){let K=$.split(`
`).map((E)=>E.trim()).filter((E)=>E.length>0&&!E.startsWith("%%")),Q=d6(K);if(Q.actors.length===0)return"";let Z=J.useAscii,z=Z?"-":"",B=Z?"|":"",U=Z?"+":"",j=Z?"+":"",_=Z?"+":"",F=Z?"+":"",H=Z?"+":"",V=Z?"+":"",P=Z?"+":"",W=Z?"+":"",G=new Map;Q.actors.forEach((E,d)=>G.set(E.id,d));let R=1,q=Q.actors.map((E)=>E.label.length+2*R+2).map((E)=>Math.ceil(E/2)),D=3,I=Array(Math.max(Q.actors.length-1,0)).fill(0);for(let E of Q.messages){let d=G.get(E.from),l=G.get(E.to);if(d===l)continue;let p=Math.min(d,l),h=Math.max(d,l),m=E.label.length+4,n=h-p,o=Math.ceil(m/n);for(let T=p;T<h;T++)I[T]=Math.max(I[T],o)}let x=[q[0]];for(let E=1;E<Q.actors.length;E++){let d=Math.max(q[E-1]+q[E]+2,I[E-1]+2,10);x[E]=x[E-1]+d}let Y=[],A=[],O=new Map,k=new Map,v=new Map,u=[],b=D;for(let E=0;E<Q.messages.length;E++){for(let p=0;p<Q.blocks.length;p++)if(Q.blocks[p].startIndex===E)b+=2,O.set(p,b-1);for(let p=0;p<Q.blocks.length;p++)for(let h=0;h<Q.blocks[p].dividers.length;h++)if(Q.blocks[p].dividers[h].index===E)b+=1,v.set(`${p}:${h}`,b),b+=1;b+=1;let d=Q.messages[E];if(d.from===d.to)A[E]=b+1,Y[E]=b,b+=3;else A[E]=b,Y[E]=b+1,b+=2;for(let p=0;p<Q.notes.length;p++)if(Q.notes[p].afterIndex===E){b+=1;let h=Q.notes[p],m=h.text.split("\\n"),n=Math.max(...m.map((y)=>y.length))+4,o=m.length+2,T=G.get(h.actorIds[0])??0,N;if(h.position==="left")N=x[T]-n-1;else if(h.position==="right")N=x[T]+2;else if(h.actorIds.length>=2){let y=G.get(h.actorIds[1])??T;N=Math.floor((x[T]+x[y])/2)-Math.floor(n/2)}else N=x[T]-Math.floor(n/2);N=Math.max(0,N),u.push({x:N,y:b,width:n,height:o,lines:m}),b+=o}for(let p=0;p<Q.blocks.length;p++)if(Q.blocks[p].endIndex===E)b+=1,k.set(p,b),b+=1}b+=1;let f=b,X=f+D,C=x[x.length-1]??0,w=q[q.length-1]??0,S=C+w+2;for(let E=0;E<Q.messages.length;E++){let d=Q.messages[E];if(d.from===d.to){let l=G.get(d.from),p=x[l]+6+2+d.label.length;S=Math.max(S,p+1)}}for(let E of u)S=Math.max(S,E.x+E.width+1);let L=P0(S,X-1);function c(E,d,l){let p=l.length+2*R+2,h=E-Math.floor(p/2);L[h][d]=U;for(let n=1;n<p-1;n++)L[h+n][d]=z;L[h+p-1][d]=j,L[h][d+1]=B,L[h+p-1][d+1]=B;let m=h+1+R;for(let n=0;n<l.length;n++)L[m+n][d+1]=l[n];L[h][d+2]=_;for(let n=1;n<p-1;n++)L[h+n][d+2]=z;L[h+p-1][d+2]=F}for(let E=0;E<Q.actors.length;E++){let d=x[E];for(let l=D;l<=f;l++)L[d][l]=B}for(let E=0;E<Q.actors.length;E++){let d=Q.actors[E];if(c(x[E],0,d.label),c(x[E],f,d.label),!Z)L[x[E]][D-1]=H,L[x[E]][f]=V}for(let E=0;E<Q.messages.length;E++){let d=Q.messages[E],l=G.get(d.from),p=G.get(d.to),h=x[l],m=x[p],n=l===p,o=d.lineStyle==="dashed",T=d.arrowHead==="filled",N=o?Z?".":"":z;if(n){let y=Y[E],g=Math.max(4,4);L[h][y]=P;for(let t=h+1;t<h+g;t++)L[t][y]=N;L[h+g][y]=Z?"+":"",L[h+g][y+1]=B;let a=h+g+2;for(let t=0;t<d.label.length;t++)if(a+t<S)L[a+t][y+1]=d.label[t];let e=T?Z?"<":"":Z?"<":"";L[h][y+2]=e;for(let t=h+1;t<h+g;t++)L[t][y+2]=N;L[h+g][y+2]=Z?"+":""}else{let y=A[E],g=Y[E],a=h<m,t=Math.floor((h+m)/2)-Math.floor(d.label.length/2);for(let z0=0;z0<d.label.length;z0++){let G0=t+z0;if(G0>=0&&G0<S)L[G0][y]=d.label[z0]}if(a){for(let G0=h+1;G0<m;G0++)L[G0][g]=N;let z0=T?Z?">":"":Z?">":"";L[m][g]=z0}else{for(let G0=m+1;G0<h;G0++)L[G0][g]=N;let z0=T?Z?"<":"":Z?"<":"";L[m][g]=z0}}}for(let E=0;E<Q.blocks.length;E++){let d=Q.blocks[E],l=O.get(E),p=k.get(E);if(l===void 0||p===void 0)continue;let h=S,m=0;for(let N=d.startIndex;N<=d.endIndex;N++){if(N>=Q.messages.length)break;let y=Q.messages[N],g=G.get(y.from)??0,a=G.get(y.to)??0;h=Math.min(h,x[Math.min(g,a)]),m=Math.max(m,x[Math.max(g,a)])}let n=Math.max(0,h-4),o=Math.min(S-1,m+4);L[n][l]=U;for(let N=n+1;N<o;N++)L[N][l]=z;L[o][l]=j;let T=d.label?`${d.type} [${d.label}]`:d.type;for(let N=0;N<T.length&&n+1+N<o;N++)L[n+1+N][l]=T[N];L[n][p]=_;for(let N=n+1;N<o;N++)L[N][p]=z;L[o][p]=F;for(let N=l+1;N<p;N++)L[n][N]=B,L[o][N]=B;for(let N=0;N<d.dividers.length;N++){let y=v.get(`${E}:${N}`);if(y===void 0)continue;let g=s();L[n][y]=P;for(let e=n+1;e<o;e++)L[e][y]=g;L[o][y]=W;let a=d.dividers[N].label;if(a){let e=`[${a}]`;for(let t=0;t<e.length&&n+1+t<o;t++)L[n+1+t][y]=e[t]}}}for(let E of u){c0(L,E.x+E.width,E.y+E.height),L[E.x][E.y]=U;for(let l=1;l<E.width-1;l++)L[E.x+l][E.y]=z;L[E.x+E.width-1][E.y]=j;for(let l=0;l<E.lines.length;l++){let p=E.y+1+l;L[E.x][p]=B,L[E.x+E.width-1][p]=B;for(let h=0;h<E.lines[l].length;h++)L[E.x+2+h][p]=E.lines[l][h]}let d=E.y+E.height-1;L[E.x][d]=_;for(let l=1;l<E.width-1;l++)L[E.x+l][d]=z;L[E.x+E.width-1][d]=F}return $6(L);function s(){return Z?"-":""}}function n6($){let J={classes:[],relationships:[],namespaces:[]},K=new Map,Q=null,Z=null,z=0;for(let B=1;B<$.length;B++){let U=$[B];if(Z&&z>0){if(U==="}"){if(z--,z===0)Z=null;continue}let W=U.match(/^<<(\w+)>>$/);if(W){Z.annotation=W[1];continue}let G=k6(U);if(G)if(G.isMethod)Z.methods.push(G.member);else Z.attributes.push(G.member);continue}let j=U.match(/^namespace\s+(\S+)\s*\{$/);if(j){Q={name:j[1],classIds:[]};continue}if(U==="}"&&Q){J.namespaces.push(Q),Q=null;continue}let _=U.match(/^class\s+(\S+?)(?:\s*~(\w+)~)?\s*\{$/);if(_){let W=_[1],G=_[2],R=E0(K,W);if(G)R.label=`${W}<${G}>`;if(Z=R,z=1,Q)Q.classIds.push(W);continue}let F=U.match(/^class\s+(\S+?)(?:\s*~(\w+)~)?\s*$/);if(F){let W=F[1],G=F[2],R=E0(K,W);if(G)R.label=`${W}<${G}>`;if(Q)Q.classIds.push(W);continue}let H=U.match(/^class\s+(\S+?)\s*\{\s*<<(\w+)>>\s*\}$/);if(H){let W=E0(K,H[1]);W.annotation=H[2];continue}let V=U.match(/^(\S+?)\s*:\s*(.+)$/);if(V){let W=V[2];if(!W.match(/<\|--|--|\*--|o--|-->|\.\.>|\.\.\|>/)){let G=E0(K,V[1]),R=k6(W);if(R)if(R.isMethod)G.methods.push(R.member);else G.attributes.push(R.member);continue}}let P=_8(U);if(P){E0(K,P.from),E0(K,P.to),J.relationships.push(P);continue}}return J.classes=[...K.values()],J}function E0($,J){let K=$.get(J);if(!K)K={id:J,label:J,attributes:[],methods:[]},$.set(J,K);return K}function k6($){let J=$.trim().replace(/;$/,"");if(!J)return null;let K="",Q=J;if(/^[+\-#~]/.test(Q))K=Q[0],Q=Q.slice(1).trim();let Z=Q.match(/^(.+?)\(([^)]*)\)(?:\s*(.+))?$/);if(Z){let F=Z[1].trim(),H=Z[3]?.trim(),V=F.endsWith("$")||Q.includes("$"),P=F.endsWith("*")||Q.includes("*");return{member:{visibility:K,name:F.replace(/[$*]$/,""),type:H||void 0,isStatic:V,isAbstract:P},isMethod:!0}}let z=Q.split(/\s+/),B,U;if(z.length>=2)U=z[0],B=z.slice(1).join(" ");else B=z[0]??Q;let j=B.endsWith("$"),_=B.endsWith("*");return{member:{visibility:K,name:B.replace(/[$*]$/,""),type:U||void 0,isStatic:j,isAbstract:_},isMethod:!1}}function _8($){let J=$.match(/^(\S+?)\s+(?:"([^"]*?)"\s+)?(<\|--|<\|\.\.|\*--|o--|-->|--\*|--o|--|>\s*|\.\.>|\.\.\|>|--)\s+(?:"([^"]*?)"\s+)?(\S+?)(?:\s*:\s*(.+))?$/);if(!J)return null;let K=J[1],Q=J[2]||void 0,Z=J[3].trim(),z=J[4]||void 0,B=J[5],U=J[6]?.trim()||void 0,j=G8(Z);if(!j)return null;return{from:K,to:B,type:j.type,markerAt:j.markerAt,label:U,fromCardinality:Q,toCardinality:z}}function G8($){switch($){case"<|--":return{type:"inheritance",markerAt:"from"};case"<|..":return{type:"realization",markerAt:"from"};case"*--":return{type:"composition",markerAt:"from"};case"--*":return{type:"composition",markerAt:"to"};case"o--":return{type:"aggregation",markerAt:"from"};case"--o":return{type:"aggregation",markerAt:"to"};case"-->":return{type:"association",markerAt:"to"};case"..>":return{type:"dependency",markerAt:"to"};case"..|>":return{type:"realization",markerAt:"to"};case"--":return{type:"association",markerAt:"to"};default:return null}}function S6($){let J=$.visibility||"",K=$.type?`: ${$.type}`:"";return`${J}${$.name}${K}`}function F8($){let J=[];if($.annotation)J.push(`<<${$.annotation}>>`);J.push($.label);let K=$.attributes.map(S6),Q=$.methods.map(S6);if(K.length===0&&Q.length===0)return[J];if(Q.length===0)return[J,K];return[J,K,Q]}function P8($,J){return{type:$,markerAt:J,dashed:$==="dependency"||$==="realization"}}function N0($,J,K){switch($){case"inheritance":case"realization":if(K==="down")return J?"^":"";else if(K==="up")return J?"v":"";else if(K==="left")return J?">":"";else return J?"<":"";case"composition":return J?"*":"";case"aggregation":return J?"o":"";case"association":case"dependency":if(K==="down")return J?"v":"";else if(K==="up")return J?"^":"";else if(K==="left")return J?"<":"";else return J?">":""}}function H8($,J){let K=$.split(`
`).map((f)=>f.trim()).filter((f)=>f.length>0&&!f.startsWith("%%")),Q=n6(K);if(Q.classes.length===0)return"";let Z=J.useAscii,z=4,B=3,U=new Map,j=new Map,_=new Map;for(let f of Q.classes){let X=F8(f);U.set(f.id,X);let C=0;for(let c of X)for(let s of c)C=Math.max(C,s.length);let w=C+4,S=0;for(let c of X)S+=Math.max(c.length,1);let L=S+(X.length-1)+2;j.set(f.id,w),_.set(f.id,L)}let F=new Map;for(let f of Q.classes)F.set(f.id,f);let H=new Map,V=new Map;for(let f of Q.relationships){let X=f.type==="inheritance"||f.type==="realization",C=X&&f.markerAt==="to"?f.to:f.from,w=X&&f.markerAt==="to"?f.from:f.to;if(!H.has(w))H.set(w,new Set);if(H.get(w).add(C),!V.has(C))V.set(C,new Set);V.get(C).add(w)}let P=new Map,G=Q.classes.filter((f)=>!H.has(f.id)||H.get(f.id).size===0).map((f)=>f.id);for(let f of G)P.set(f,0);let R=Q.classes.length-1,M=0;while(M<G.length){let f=G[M++],X=V.get(f);if(!X)continue;for(let C of X){let w=(P.get(f)??0)+1;if(w>R)continue;if(!P.has(C)||P.get(C)<w)P.set(C,w),G.push(C)}}for(let f of Q.classes)if(!P.has(f.id))P.set(f.id,0);let q=Math.max(...[...P.values()],0),D=Array.from({length:q+1},()=>[]);for(let f of Q.classes)D[P.get(f.id)].push(f.id);let I=new Map,x=0;for(let f=0;f<=q;f++){let X=D[f];if(X.length===0)continue;let C=0,w=0;for(let S of X){let L=F.get(S),c=j.get(S),s=_.get(S);I.set(S,{cls:L,sections:U.get(S),x:C,y:x,width:c,height:s}),C+=c+z,w=Math.max(w,s)}x+=w+B}let Y=0,A=0;for(let f of I.values())Y=Math.max(Y,f.x+f.width),A=Math.max(A,f.y+f.height);Y+=4,A+=2;let O=P0(Y-1,A-1);for(let f of I.values()){let X=p6(f.sections,Z);for(let C=0;C<X.length;C++)for(let w=0;w<X[0].length;w++){let S=X[C][w];if(S!==" "){let L=f.x+C,c=f.y+w;if(L<Y&&c<A)O[L][c]=S}}}let k=Z?"-":"",v=Z?"|":"",u=Z?".":"",b=Z?":":"";for(let f of Q.relationships){let X=I.get(f.from),C=I.get(f.to);if(!X||!C)continue;let w=P8(f.type,f.markerAt),S=w.dashed?u:k,L=w.dashed?b:v,c=X.x+Math.floor(X.width/2),s=X.y+X.height-1,E=C.x+Math.floor(C.width/2),d=C.y;if(s<d){let l=s+Math.floor((d-s)/2);for(let p=s+1;p<=l;p++)if(p<A)O[c][p]=L;if(c!==E){let p=Math.min(c,E),h=Math.max(c,E);for(let m=p;m<=h;m++)if(m<Y&&l<A)O[m][l]=S;if(!Z&&l<A)if(c<E)O[c][l]="",O[E][l]="";else O[c][l]="",O[E][l]=""}for(let p=l+1;p<d;p++)if(p<A)O[E][p]=L;if(w.markerAt==="to"){let p=N0(w.type,Z,"down"),h=d-1;if(h>=0&&h<A)for(let m=0;m<p.length;m++){let n=E-Math.floor(p.length/2)+m;if(n>=0&&n<Y)O[n][h]=p[m]}}if(w.markerAt==="from"){let p=N0(w.type,Z,"down"),h=s+1;if(h<A)for(let m=0;m<p.length;m++){let n=c-Math.floor(p.length/2)+m;if(n>=0&&n<Y)O[n][h]=p[m]}}}else if(C.y+C.height-1<X.y){let l=X.y,p=C.y+C.height-1,h=p+Math.floor((l-p)/2);for(let m=l-1;m>=h;m--)if(m>=0&&m<A)O[c][m]=L;if(c!==E){let m=Math.min(c,E),n=Math.max(c,E);for(let o=m;o<=n;o++)if(o<Y&&h>=0&&h<A)O[o][h]=S;if(!Z&&h>=0&&h<A)if(c<E)O[c][h]="",O[E][h]="";else O[c][h]="",O[E][h]=""}for(let m=h-1;m>p;m--)if(m>=0&&m<A)O[E][m]=L;if(w.markerAt==="from"){let m=N0(w.type,Z,"up"),n=l-1;if(n>=0&&n<A)for(let o=0;o<m.length;o++){let T=c-Math.floor(m.length/2)+o;if(T>=0&&T<Y)O[T][n]=m[o]}}if(w.markerAt==="to"){let n=w.type==="inheritance"||w.type==="realization"?"down":"up",o=N0(w.type,Z,n),T=p+1;if(T<A)for(let N=0;N<o.length;N++){let y=E-Math.floor(o.length/2)+N;if(y>=0&&y<Y)O[y][T]=o[N]}}}else{let l=Math.max(s,C.y+C.height-1)+2;c0(O,Y,l+1);for(let m=s+1;m<=l;m++)O[c][m]=L;let p=Math.min(c,E),h=Math.max(c,E);for(let m=p;m<=h;m++)O[m][l]=S;for(let m=l-1;m>=C.y+C.height;m--)O[E][m]=L;if(w.markerAt==="from"){let m=N0(w.type,Z,"down"),n=s+1;if(n<A)for(let o=0;o<m.length;o++){let T=c-Math.floor(m.length/2)+o;if(T>=0&&T<Y)O[T][n]=m[o]}}if(w.markerAt==="to"){let m=N0(w.type,Z,"up"),n=C.y+C.height;if(n<A)for(let o=0;o<m.length;o++){let T=E-Math.floor(m.length/2)+o;if(T>=0&&T<Y)O[T][n]=m[o]}}}if(f.label){let l=` ${f.label} `,p=Math.floor((c+E)/2),h;if(s<d)h=Math.floor((s+1+d-1)/2);else if(C.y+C.height-1<X.y){let n=C.y+C.height-1;h=Math.floor((n+1+X.y-1)/2)}else h=Math.max(s,C.y+C.height-1)+2;let m=p-Math.floor(l.length/2);for(let n=0;n<l.length;n++){let o=m+n;if(o>=0&&o<Y&&h>=0&&h<A)O[o][h]=l[n]}}}return $6(O)}function g6($){let J={entities:[],relationships:[]},K=new Map,Q=null;for(let Z=1;Z<$.length;Z++){let z=$[Z];if(Q){if(z==="}"){Q=null;continue}let j=W8(z);if(j)Q.attributes.push(j);continue}let B=z.match(/^(\S+)\s*\{$/);if(B){let j=B[1];Q=V6(K,j);continue}let U=M8(z);if(U){V6(K,U.entity1),V6(K,U.entity2),J.relationships.push(U);continue}}return J.entities=[...K.values()],J}function V6($,J){let K=$.get(J);if(!K)K={id:J,label:J,attributes:[]},$.set(J,K);return K}function W8($){let J=$.match(/^(\S+)\s+(\S+)(?:\s+(.+))?$/);if(!J)return null;let K=J[1],Q=J[2],Z=J[3]?.trim()??"",z=[],B,U=Z.match(/"([^"]*)"/);if(U)B=U[1];let j=Z.replace(/"[^"]*"/,"").trim();for(let _ of j.split(/\s+/)){let F=_.toUpperCase();if(F==="PK"||F==="FK"||F==="UK")z.push(F)}return{type:K,name:Q,keys:z,comment:B}}function M8($){let J=$.match(/^(\S+)\s+([|o}{]+(?:--|\.\.)[|o}{]+)\s+(\S+)\s*:\s*(.+)$/);if(!J)return null;let K=J[1],Q=J[2],Z=J[3],z=J[4].trim(),B=Q.match(/^([|o}{]+)(--|\.\.?)([|o}{]+)$/);if(!B)return null;let U=B[1],j=B[2],_=B[3],F=w6(U),H=w6(_),V=j==="--";if(!F||!H)return null;return{entity1:K,entity2:Z,cardinality1:F,cardinality2:H,label:z,identifying:V}}function w6($){let J=$.split("").sort().join("");if(J==="||")return"one";if(J==="o|")return"zero-one";if(J==="|}"||J==="{|")return"many";if(J==="{o"||J==="o{")return"zero-many";return null}function R8($){return`${$.keys.length>0?$.keys.join(",")+" ":"   "}${$.type} ${$.name}`}function q8($){let J=[$.label],K=$.attributes.map(R8);if(K.length===0)return[J];return[J,K]}function d0($,J){if(J)switch($){case"one":return"||";case"zero-one":return"o|";case"many":return"}|";case"zero-many":return"o{"}else switch($){case"one":return"";case"zero-one":return"o";case"many":return"";case"zero-many":return"o"}}function Y8($,J){let K=$.split(`
`).map((A)=>A.trim()).filter((A)=>A.length>0&&!A.startsWith("%%")),Q=g6(K);if(Q.entities.length===0)return"";let Z=J.useAscii,z=6,B=4,U=new Map,j=new Map,_=new Map;for(let A of Q.entities){let O=q8(A);U.set(A.id,O);let k=0;for(let f of O)for(let X of f)k=Math.max(k,X.length);let v=k+4,u=0;for(let f of O)u+=Math.max(f.length,1);let b=u+(O.length-1)+2;j.set(A.id,v),_.set(A.id,b)}let F=Math.max(2,Math.ceil(Math.sqrt(Q.entities.length))),H=new Map,V=0,P=0,W=0,G=0;for(let A of Q.entities){let O=j.get(A.id),k=_.get(A.id);if(G>=F)P+=W+B,V=0,W=0,G=0;H.set(A.id,{entity:A,sections:U.get(A.id),x:V,y:P,width:O,height:k}),V+=O+z,W=Math.max(W,k),G++}let R=0,M=0;for(let A of H.values())R=Math.max(R,A.x+A.width),M=Math.max(M,A.y+A.height);R+=4,M+=2;let q=P0(R-1,M-1);for(let A of H.values()){let O=p6(A.sections,Z);for(let k=0;k<O.length;k++)for(let v=0;v<O[0].length;v++){let u=O[k][v];if(u!==" "){let b=A.x+k,f=A.y+v;if(b<R&&f<M)q[b][f]=u}}}let D=Z?"-":"",I=Z?"|":"",x=Z?".":"",Y=Z?":":"";for(let A of Q.relationships){let O=H.get(A.entity1),k=H.get(A.entity2);if(!O||!k)continue;let v=A.identifying?D:x,u=A.identifying?I:Y,b=O.x+Math.floor(O.width/2),f=O.y+Math.floor(O.height/2),X=k.x+Math.floor(k.width/2),C=k.y+Math.floor(k.height/2);if(Math.abs(f-C)<Math.max(O.height,k.height)){let[S,L]=b<X?[O,k]:[k,O],[c,s]=b<X?[A.cardinality1,A.cardinality2]:[A.cardinality2,A.cardinality1],E=S.x+S.width,d=L.x-1,l=S.y+Math.floor(S.height/2);for(let m=E;m<=d;m++)if(m<R)q[m][l]=v;let p=d0(c,Z);for(let m=0;m<p.length;m++){let n=E+m;if(n<R)q[n][l]=p[m]}let h=d0(s,Z);for(let m=0;m<h.length;m++){let n=d-h.length+1+m;if(n>=0&&n<R)q[n][l]=h[m]}if(A.label){let m=Math.floor((E+d)/2),n=Math.max(E,m-Math.floor(A.label.length/2)),o=l-1;if(o>=0)for(let T=0;T<A.label.length;T++){let N=n+T;if(N>=E&&N<=d&&N<R)q[N][o]=A.label[T]}}}else{let[S,L]=f<C?[O,k]:[k,O],[c,s]=f<C?[A.cardinality1,A.cardinality2]:[A.cardinality2,A.cardinality1],E=S.y+S.height,d=L.y-1,l=S.x+Math.floor(S.width/2);for(let o=E;o<=d;o++)if(o<M)q[l][o]=u;let p=L.x+Math.floor(L.width/2);if(l!==p){let o=Math.floor((E+d)/2),T=Math.min(l,p),N=Math.max(l,p);for(let y=T;y<=N;y++)if(y<R&&o<M)q[y][o]=v;for(let y=o+1;y<=d;y++)if(y<M)q[p][y]=u}let h=d0(c,Z);if(E<M)for(let o=0;o<h.length;o++){let T=l-Math.floor(h.length/2)+o;if(T>=0&&T<R)q[T][E]=h[o]}let m=l!==p?p:l,n=d0(s,Z);if(d>=0&&d<M)for(let o=0;o<n.length;o++){let T=m-Math.floor(n.length/2)+o;if(T>=0&&T<R)q[T][d]=n[o]}if(A.label){let o=Math.floor((E+d)/2),T=l+2;if(o>=0)for(let N=0;N<A.label.length;N++){let y=T+N;if(y>=0)c0(q,y+1,o+1),q[y][o]=A.label[N]}}}}return $6(q)}function A8($){let J=$.trim().split(`
`)[0]?.trim().toLowerCase()??"";if(/^sequencediagram\s*$/.test(J))return"sequence";if(/^classdiagram\s*$/.test(J))return"class";if(/^erdiagram\s*$/.test(J))return"er";return"flowchart"}function o6($,J={}){let K={useAscii:J.useAscii??!1,paddingX:J.paddingX??5,paddingY:J.paddingY??5,boxBorderPadding:J.boxBorderPadding??1,graphDirection:"TD"};switch(A8($)){case"sequence":return j8($,K);case"class":return H8($,K);case"er":return Y8($,K);case"flowchart":default:{let Z=u6($);if(Z.direction==="LR"||Z.direction==="RL")K.graphDirection="LR";else K.graphDirection="TD";let z=E7(Z,K);if(z8(z),e7(z),Z.direction==="BT")I7(z.canvas);return $6(z.canvas)}}}function _0($,J,K){let Q=K>=600?0.58:K>=500?0.55:0.52;return $.length*J*Q}function s6($,J){return $.length*J*0.6}var r={nodeLabel:13,edgeLabel:11,groupHeader:12},K0={nodeLabel:500,edgeLabel:400,groupHeader:600},O8=8,y0={horizontal:16,vertical:10,diamondExtra:24},Z0={outerBox:1,innerBox:0.75,connector:0.75},j0="0.35em",n0={width:8,height:4.8};function k0($,J,K,Q){return{x:$-K/2,y:J-Q/2}}function g0($,J,K,Q,Z){let z=$.x-J,B=$.y-K;if(Math.abs(z)<0.5&&Math.abs(B)<0.5)return $;let U=1/(Math.abs(z)/Q+Math.abs(B)/Z);return{x:J+U*z,y:K+U*B}}function o0($,J,K,Q){let Z=$.x-J,z=$.y-K,B=Math.sqrt(Z*Z+z*z);if(B<0.5)return $;let U=Q/B;return{x:J+U*Z,y:K+U*z}}function h0($,J=!0){if($.length<2)return $;let K=[$[0]];for(let Q=1;Q<$.length;Q++){let Z=K[K.length-1],z=$[Q],B=Math.abs(z.x-Z.x),U=Math.abs(z.y-Z.y);if(B<1||U<1){K.push(z);continue}if(J)K.push({x:Z.x,y:z.y});else K.push({x:z.x,y:Z.y});K.push(z)}return X8(K)}function X8($){if($.length<3)return $;let J=[$[0]];for(let K=1;K<$.length-1;K++){let Q=J[J.length-1],Z=$[K],z=$[K+1],B=Math.abs(Q.x-Z.x)<1&&Math.abs(Z.x-z.x)<1,U=Math.abs(Q.y-Z.y)<1&&Math.abs(Z.y-z.y)<1;if(B||U)continue;J.push(Z)}return J.push($[$.length-1]),J}function J6($,J,K){if($.length<2)return $;let Q=$.map((Z)=>({...Z}));if(K){let Z=Q.length-1;if($.length===2){let z=Q[0],B=Q[Z],U=Math.abs(B.x-z.x);if(Math.abs(B.y-z.y)>=U){let F=B.y>z.y?K.cy-K.hh:K.cy+K.hh;Q[Z]={x:B.x,y:F}}else{let F=B.x>z.x?K.cx-K.hw:K.cx+K.hw;Q[Z]={x:F,y:B.y}}}else{let z=Q[Z-1],B=Q[Z],U=Math.abs(B.x-z.x),j=Math.abs(B.y-z.y),_=j<1&&U>=1,F=U<1&&j>=1,H=!_&&!F&&j<U,V=!_&&!F&&U<j;if(_){let W=B.x>z.x?K.cx-K.hw:K.cx+K.hw;Q[Z]={x:W,y:K.cy},Q[Z-1]={...z,y:K.cy}}else if(F){let W=B.y>z.y?K.cy-K.hh:K.cy+K.hh;Q[Z]={x:K.cx,y:W},Q[Z-1]={...z,x:K.cx}}else if(H){let W=B.x>z.x?K.cx-K.hw:K.cx+K.hw;if(z.y>=K.cy-K.hh&&z.y<=K.cy+K.hh)Q[Z]={x:W,y:z.y};else Q[Z]={x:W,y:K.cy},Q[Z-1]={...z,y:K.cy}}else if(V){let W=B.y>z.y?K.cy-K.hh:K.cy+K.hh;if(z.x>=K.cx-K.hw&&z.x<=K.cx+K.hw)Q[Z]={x:z.x,y:W};else Q[Z]={x:K.cx,y:W},Q[Z-1]={...z,x:K.cx}}}}if(J&&$.length>=3){let Z=Q[0],z=Q[1],B=Math.abs(z.x-Z.x),U=Math.abs(z.y-Z.y),j=U<1&&B>=1,_=B<1&&U>=1,F=!j&&!_&&U<B,H=!j&&!_&&B<U;if(j){let P=z.x>Z.x?J.cx+J.hw:J.cx-J.hw;Q[0]={x:P,y:J.cy},Q[1]={...Q[1],y:J.cy}}else if(_){let P=z.y>Z.y?J.cy+J.hh:J.cy-J.hh;Q[0]={x:J.cx,y:P},Q[1]={...Q[1],x:J.cx}}else if(F){let P=z.x>Z.x?J.cx+J.hw:J.cx-J.hw;if(z.y>=J.cy-J.hh&&z.y<=J.cy+J.hh)Q[0]={x:P,y:z.y};else Q[0]={x:P,y:J.cy},Q[1]={...Q[1],y:J.cy}}else if(H){let P=z.y>Z.y?J.cy+J.hh:J.cy-J.hh;if(z.x>=J.cx-J.hw&&z.x<=J.cx+J.hw)Q[0]={x:z.x,y:P};else Q[0]={x:J.cx,y:P},Q[1]={...Q[1],x:J.cx}}}return Q}var s0=new Set(["circle","doublecircle","state-start","state-end"]),i0=new Set(["diamond","circle","doublecircle","state-start","state-end"]),D8={font:"Inter",padding:40,nodeSpacing:24,layerSpacing:40};function C8($,J,K){let Q=new Y0.default.graphlib.Graph({directed:!0,compound:!0});Q.setGraph({rankdir:i6($.direction),acyclicer:"greedy",nodesep:K.nodeSpacing,ranksep:K.layerSpacing,marginx:16,marginy:12}),Q.setDefaultEdgeLabel(()=>({}));let Z=new Set;Z.add($.id),j6($,Z);for(let V of $.nodeIds){let P=J.nodes.get(V);if(P){let W=z6(V,P.label,P.shape);Q.setNode(V,{label:P.label,width:W.width,height:W.height})}}for(let V of $.children)B6(Q,V,J);let z=new Set;for(let V=0;V<J.edges.length;V++){let P=J.edges[V];if(Z.has(P.source)&&Z.has(P.target)){z.add(V);let W={_index:V};if(P.label)W.label=P.label,W.width=_0(P.label,r.edgeLabel,K0.edgeLabel)+8,W.height=r.edgeLabel+6,W.labelpos="c";Q.setEdge(P.source,P.target,W)}}Y0.default.layout(Q);let B=$.direction==="TD"||$.direction==="TB"||$.direction==="BT",U=new Set;for(let V of $.children)G6(V,U);let j=[];for(let V of Q.nodes()){if(U.has(V))continue;let P=J.nodes.get(V);if(!P)continue;let W=Q.node(V);if(!W)continue;let G=k0(W.x,W.y,W.width,W.height);j.push({id:V,label:P.label,shape:P.shape,x:G.x,y:G.y,width:W.width,height:W.height,inlineStyle:t6(J,V)})}let _=Q.edges().map((V)=>{let P=Q.edge(V),W=J.edges[P._index],G=P.points??[];if(G.length>0){let A=J.nodes.get(V.v)?.shape;if(A==="diamond"){let k=Q.node(V.v);G[0]=g0(G[0],k.x,k.y,k.width/2,k.height/2)}else if(A&&s0.has(A)){let k=Q.node(V.v);G[0]=o0(G[0],k.x,k.y,Math.min(k.width,k.height)/2)}let O=J.nodes.get(V.w)?.shape;if(O==="diamond"){let k=Q.node(V.w),v=G.length-1;G[v]=g0(G[v],k.x,k.y,k.width/2,k.height/2)}else if(O&&s0.has(O)){let k=Q.node(V.w),v=G.length-1;G[v]=o0(G[v],k.x,k.y,Math.min(k.width,k.height)/2)}}let R=h0(G,B),M=J.nodes.get(V.v)?.shape,q=J.nodes.get(V.w)?.shape,D=M&&!i0.has(M)||!M?(()=>{let A=Q.node(V.v);return A?{cx:A.x,cy:A.y,hw:A.width/2,hh:A.height/2}:null})():null,I=q&&!i0.has(q)||!q?(()=>{let A=Q.node(V.w);return A?{cx:A.x,cy:A.y,hw:A.width/2,hh:A.height/2}:null})():null,x=J6(R,D,I),Y;if(W.label&&P.x!=null&&P.y!=null)Y={x:P.x,y:P.y};return{source:W.source,target:W.target,label:W.label,style:W.style,hasArrowStart:W.hasArrowStart,hasArrowEnd:W.hasArrowEnd,points:x,labelPosition:Y}}),F=$.children.map((V)=>_6(Q,V)),H=Q.graph();return{id:$.id,label:$.label,width:H.width??200,height:H.height??100,nodes:j,edges:_,groups:F,nodeIds:Z,internalEdgeIndices:z}}async function I8($,J={}){let K={...D8,...J},Q=new Map;for(let F of $.subgraphs)if(F.direction&&F.direction!==$.direction)Q.set(F.id,C8(F,$,K));let Z=new Y0.default.graphlib.Graph({directed:!0,compound:!0});Z.setGraph({rankdir:i6($.direction),acyclicer:"greedy",nodesep:K.nodeSpacing,ranksep:K.layerSpacing,marginx:K.padding,marginy:K.padding}),Z.setDefaultEdgeLabel(()=>({}));let z=new Set;for(let F of $.subgraphs)z.add(F.id),j6(F,z);for(let[F,H]of $.nodes)if(!z.has(F)){let V=z6(F,H.label,H.shape);Z.setNode(F,{label:H.label,width:V.width,height:V.height})}for(let F of $.subgraphs)if(Q.has(F.id)){let H=Q.get(F.id);Z.setNode(F.id,{width:H.width,height:H.height})}else B6(Z,F,$);let B=new Map,U=new Map;for(let F of $.subgraphs)if(!Q.has(F.id))a6(F,B,U);for(let[F,H]of Q)for(let V of H.nodeIds)B.set(V,F),U.set(V,F);let j=new Set;for(let F of Q.values())for(let H of F.internalEdgeIndices)j.add(H);let _=new Set;for(let F=0;F<$.edges.length;F++){if(j.has(F))continue;let H=$.edges[F],V=U.get(H.source)??H.source,P=B.get(H.target)??H.target,W={_index:F};if(H.label)W.label=H.label,W.width=_0(H.label,r.edgeLabel,K0.edgeLabel)+8,W.height=r.edgeLabel+6,W.labelpos="c";if(!_.has(P))W.weight=2,_.add(P);Z.setEdge(V,P,W)}try{Y0.default.layout(Z)}catch(F){let H=F instanceof Error?F.message:String(F);throw Error(`Dagre layout failed: ${H}`)}return L8(Z,$,K.padding,Q)}function i6($){switch($){case"LR":return"LR";case"RL":return"RL";case"BT":return"BT";case"TD":case"TB":default:return"TB"}}function z6($,J,K){let Z=_0(J,r.nodeLabel,K0.nodeLabel)+y0.horizontal*2,z=r.nodeLabel+y0.vertical*2;if(K==="diamond"){let B=Math.max(Z,z)+y0.diamondExtra;Z=B,z=B}if(K==="circle"||K==="doublecircle"){let B=Math.ceil(Math.sqrt(Z*Z+z*z))+8;Z=K==="doublecircle"?B+12:B,z=Z}if(K==="hexagon")Z+=y0.horizontal;if(K==="trapezoid"||K==="trapezoid-alt")Z+=y0.horizontal;if(K==="asymmetric")Z+=12;if(K==="cylinder")z+=14;if(K==="state-start"||K==="state-end")Z=28,z=28;return Z=Math.max(Z,60),z=Math.max(z,36),{width:Z,height:z}}function B6($,J,K,Q){if($.setNode(J.id,{label:J.label}),Q)$.setParent(J.id,Q);for(let Z of J.nodeIds){let z=K.nodes.get(Z);if(z){let B=z6(Z,z.label,z.shape);$.setNode(Z,{label:z.label,width:B.width,height:B.height}),$.setParent(Z,J.id)}}for(let Z of J.children)B6($,Z,K,J.id)}function a6($,J,K){for(let B of $.children)a6(B,J,K);let Q=[...$.nodeIds,...$.children.map((B)=>B.id)];if(Q.length===0){J.set($.id,$.id),K.set($.id,$.id);return}let Z=Q[0],z=Q[Q.length-1];J.set($.id,J.get(Z)??Z),K.set($.id,K.get(z)??z)}function t6($,J){let K=$.classAssignments.get(J),Q=K?$.classDefs.get(K):void 0,Z=$.nodeStyles.get(J);if(!Q&&!Z)return;return{...Q,...Z}}function j6($,J){for(let K of $.nodeIds)J.add(K);for(let K of $.children)j6(K,J)}function L8($,J,K,Q){let Z=[],z=[],B=new Set;for(let M of J.subgraphs)G6(M,B);let U=new Set;if(Q)for(let M of Q.values())for(let q of M.nodeIds)U.add(q);for(let M of $.nodes()){if(B.has(M))continue;let q=J.nodes.get(M);if(!q)continue;let D=$.node(M);if(!D)continue;let I=k0(D.x,D.y,D.width,D.height);Z.push({id:M,label:q.label,shape:q.shape,x:I.x,y:I.y,width:D.width,height:D.height,inlineStyle:t6(J,M)})}for(let M of J.subgraphs)z.push(_6($,M));let j=J.direction==="TD"||J.direction==="TB"||J.direction==="BT",_=$.edges().map((M)=>{let q=$.edge(M),D=J.edges[q._index],I=q.points??[];if(I.length>0){let b=J.nodes.get(M.v)?.shape;if(b==="diamond"){let X=$.node(M.v);I[0]=g0(I[0],X.x,X.y,X.width/2,X.height/2)}else if(b&&s0.has(b)){let X=$.node(M.v);I[0]=o0(I[0],X.x,X.y,Math.min(X.width,X.height)/2)}let f=J.nodes.get(M.w)?.shape;if(f==="diamond"){let X=$.node(M.w),C=I.length-1;I[C]=g0(I[C],X.x,X.y,X.width/2,X.height/2)}else if(f&&s0.has(f)){let X=$.node(M.w),C=I.length-1;I[C]=o0(I[C],X.x,X.y,Math.min(X.width,X.height)/2)}}let x=h0(I,j),Y=J.nodes.get(M.v)?.shape,A=J.nodes.get(M.w)?.shape,O=Y&&!i0.has(Y)||!Y?(()=>{let b=$.node(M.v);return b?{cx:b.x,cy:b.y,hw:b.width/2,hh:b.height/2}:null})():null,k=A&&!i0.has(A)||!A?(()=>{let b=$.node(M.w);return b?{cx:b.x,cy:b.y,hw:b.width/2,hh:b.height/2}:null})():null,v=J6(x,O,k),u;if(D.label&&q.x!=null&&q.y!=null)u={x:q.x,y:q.y};return{source:D.source,target:D.target,label:D.label,style:D.style,hasArrowStart:D.hasArrowStart,hasArrowEnd:D.hasArrowEnd,points:v,labelPosition:u}});if(Q&&Q.size>0){let M=new Map;for(let q of Z)M.set(q.id,{cx:q.x+q.width/2,cy:q.y+q.height/2});for(let[q,D]of Q){let I=$.node(q);if(!I)continue;let x=k0(I.x,I.y,I.width,I.height);for(let A of D.nodes){let O={...A,x:A.x+x.x,y:A.y+x.y};Z.push(O),M.set(O.id,{cx:O.x+O.width/2,cy:O.y+O.height/2})}for(let A of D.edges)_.push({...A,points:A.points.map((O)=>({x:O.x+x.x,y:O.y+x.y})),labelPosition:A.labelPosition?{x:A.labelPosition.x+x.x,y:A.labelPosition.y+x.y}:void 0});let Y=$7(z,q);if(Y&&D.groups.length>0)Y.children=D.groups.map((A)=>J7(A,x.x,x.y))}for(let q of _){if(U.has(q.source)&&U.has(q.target))continue;let D=!1;if(U.has(q.source)){let I=M.get(q.source);if(I&&q.points.length>0)q.points[0]={x:I.cx,y:I.cy},D=!0}if(U.has(q.target)){let I=M.get(q.target);if(I&&q.points.length>0)q.points[q.points.length-1]={x:I.cx,y:I.cy},D=!0}if(D)q.points=h0(q.points,j)}}let F=r.groupHeader+16;T8(z,F);let H=e6(z),V=[...Z.map((M)=>M.y),...H.map((M)=>M.y)],P=V.length>0?Math.min(...V):K,W=$.graph().width??800,G=$.graph().height??600;if(P<K){let M=K-P;for(let q of Z)q.y+=M;for(let q of _){for(let D of q.points)D.y+=M;if(q.labelPosition)q.labelPosition.y+=M}for(let q of H)q.y+=M;G+=M}let R=Math.max(...Z.map((M)=>M.y+M.height),...H.map((M)=>M.y+M.height),..._.flatMap((M)=>M.points.map((q)=>q.y)));if(R+K>G)G=R+K;return{width:W,height:G,nodes:Z,edges:_,groups:z}}function _6($,J){let K=$.node(J.id),Q=K?k0(K.x,K.y,K.width,K.height):{x:0,y:0};return{id:J.id,label:J.label,x:Q.x,y:Q.y,width:K?.width??0,height:K?.height??0,children:J.children.map((Z)=>_6($,Z))}}function T8($,J){for(let K of $)r6(K,J)}function r6($,J){for(let K of $.children)r6(K,J);if($.children.length>0){let K=$.y,Q=$.y+$.height;for(let Z of $.children)K=Math.min(K,Z.y),Q=Math.max(Q,Z.y+Z.height);$.height=Q-K,$.y=K}if($.label){let K=J+O8;$.y-=K,$.height+=K}}function e6($){let J=[];for(let K of $)J.push(K),J.push(...e6(K.children));return J}function $7($,J){for(let K of $){if(K.id===J)return K;let Q=$7(K.children,J);if(Q)return Q}return}function J7($,J,K){return{...$,x:$.x+J,y:$.y+K,children:$.children.map((Q)=>J7(Q,J,K))}}function G6($,J){J.add($.id);for(let K of $.children)G6(K,J)}function E8($,J,K="Inter",Q=!1){let Z=[];Z.push(e0($.width,$.height,J,Q)),Z.push(r0(K,!1)),Z.push("<defs>"),Z.push(N8()),Z.push("</defs>");for(let z of $.groups)Z.push(Q7(z));for(let z of $.edges)Z.push(k8(z));for(let z of $.edges)if(z.label)Z.push(w8(z));for(let z of $.nodes)Z.push(b8(z));for(let z of $.nodes)Z.push(i8(z));return Z.push("</svg>"),Z.join(`
`)}function N8(){let{width:$,height:J}=n0;return`  <marker id="arrowhead" markerWidth="${$}" markerHeight="${J}" refX="${$}" refY="${J/2}" orient="auto">
    <polygon points="0 0, ${$} ${J/2}, 0 ${J}" fill="var(--_arrow)" />
  </marker>
  <marker id="arrowhead-start" markerWidth="${$}" markerHeight="${J}" refX="0" refY="${J/2}" orient="auto-start-reverse">
    <polygon points="${$} 0, 0 ${J/2}, ${$} ${J}" fill="var(--_arrow)" />
  </marker>`}function Q7($,J){let K=r.groupHeader+16,Q=[];Q.push(`<rect x="${$.x}" y="${$.y}" width="${$.width}" height="${$.height}" rx="0" ry="0" fill="var(--_group-fill)" stroke="var(--_node-stroke)" stroke-width="${Z0.outerBox}" />`),Q.push(`<rect x="${$.x}" y="${$.y}" width="${$.width}" height="${K}" rx="0" ry="0" fill="var(--_group-hdr)" stroke="var(--_node-stroke)" stroke-width="${Z0.outerBox}" />`),Q.push(`<text x="${$.x+12}" y="${$.y+K/2}" dy="${j0}" font-size="${r.groupHeader}" font-weight="${K0.groupHeader}" fill="var(--_text-sec)">${F6($.label)}</text>`);for(let Z of $.children)Q.push(Q7(Z));return Q.join(`
`)}function k8($){if($.points.length<2)return"";let J=S8($.points),K=$.style==="dotted"?' stroke-dasharray="4 4"':"",Q=$.style==="thick"?Z0.connector*2:Z0.connector,Z="";if($.hasArrowEnd)Z+=' marker-end="url(#arrowhead)"';if($.hasArrowStart)Z+=' marker-start="url(#arrowhead-start)"';return`<polyline points="${J}" fill="none" stroke="var(--_line)" stroke-width="${Q}"${K}${Z} />`}function S8($){return $.map((J)=>`${J.x},${J.y}`).join(" ")}function w8($,J){let K=$.labelPosition??f8($.points),Q=$.label,Z=_0(Q,r.edgeLabel,K0.edgeLabel),z=8,B=Z+16,U=r.edgeLabel+16;return`<rect x="${K.x-B/2}" y="${K.y-U/2}" width="${B}" height="${U}" rx="4" ry="4" fill="var(--bg)" stroke="var(--_inner-stroke)" stroke-width="0.5" />
<text x="${K.x}" y="${K.y}" text-anchor="middle" dy="${j0}" font-size="${r.edgeLabel}" font-weight="${K0.edgeLabel}" fill="var(--_text-muted)">${F6(Q)}</text>`}function f8($){if($.length===0)return{x:0,y:0};if($.length===1)return $[0];let J=0;for(let Q=1;Q<$.length;Q++)J+=f6($[Q-1],$[Q]);let K=J/2;for(let Q=1;Q<$.length;Q++){let Z=f6($[Q-1],$[Q]);if(K<=Z){let z=K/Z;return{x:$[Q-1].x+z*($[Q].x-$[Q-1].x),y:$[Q-1].y+z*($[Q].y-$[Q-1].y)}}K-=Z}return $[$.length-1]}function f6($,J){return Math.sqrt((J.x-$.x)**2+(J.y-$.y)**2)}function b8($){let{x:J,y:K,width:Q,height:Z,shape:z,inlineStyle:B}=$,U=B?.fill??"var(--_node-fill)",j=B?.stroke??"var(--_node-stroke)",_=B?.["stroke-width"]??String(Z0.innerBox);switch(z){case"diamond":return m8(J,K,Q,Z,U,j,_);case"rounded":return x8(J,K,Q,Z,U,j,_);case"stadium":return v8(J,K,Q,Z,U,j,_);case"circle":return u8(J,K,Q,Z,U,j,_);case"subroutine":return h8(J,K,Q,Z,U,j,_);case"doublecircle":return c8(J,K,Q,Z,U,j,_);case"hexagon":return p8(J,K,Q,Z,U,j,_);case"cylinder":return l8(J,K,Q,Z,U,j,_);case"asymmetric":return d8(J,K,Q,Z,U,j,_);case"trapezoid":return n8(J,K,Q,Z,U,j,_);case"trapezoid-alt":return g8(J,K,Q,Z,U,j,_);case"state-start":return o8(J,K,Q,Z);case"state-end":return s8(J,K,Q,Z);case"rectangle":default:return y8(J,K,Q,Z,U,j,_)}}function y8($,J,K,Q,Z,z,B){return`<rect x="${$}" y="${J}" width="${K}" height="${Q}" rx="0" ry="0" fill="${Z}" stroke="${z}" stroke-width="${B}" />`}function x8($,J,K,Q,Z,z,B){return`<rect x="${$}" y="${J}" width="${K}" height="${Q}" rx="6" ry="6" fill="${Z}" stroke="${z}" stroke-width="${B}" />`}function v8($,J,K,Q,Z,z,B){let U=Q/2;return`<rect x="${$}" y="${J}" width="${K}" height="${Q}" rx="${U}" ry="${U}" fill="${Z}" stroke="${z}" stroke-width="${B}" />`}function u8($,J,K,Q,Z,z,B){let U=$+K/2,j=J+Q/2,_=Math.min(K,Q)/2;return`<circle cx="${U}" cy="${j}" r="${_}" fill="${Z}" stroke="${z}" stroke-width="${B}" />`}function m8($,J,K,Q,Z,z,B){let U=$+K/2,j=J+Q/2,_=K/2,F=Q/2;return`<polygon points="${[`${U},${j-F}`,`${U+_},${j}`,`${U},${j+F}`,`${U-_},${j}`].join(" ")}" fill="${Z}" stroke="${z}" stroke-width="${B}" />`}function h8($,J,K,Q,Z,z,B){return`<rect x="${$}" y="${J}" width="${K}" height="${Q}" rx="0" ry="0" fill="${Z}" stroke="${z}" stroke-width="${B}" />
<line x1="${$+8}" y1="${J}" x2="${$+8}" y2="${J+Q}" stroke="${z}" stroke-width="${B}" />
<line x1="${$+K-8}" y1="${J}" x2="${$+K-8}" y2="${J+Q}" stroke="${z}" stroke-width="${B}" />`}function c8($,J,K,Q,Z,z,B){let U=$+K/2,j=J+Q/2,_=Math.min(K,Q)/2,F=_-5;return`<circle cx="${U}" cy="${j}" r="${_}" fill="${Z}" stroke="${z}" stroke-width="${B}" />
<circle cx="${U}" cy="${j}" r="${F}" fill="${Z}" stroke="${z}" stroke-width="${B}" />`}function p8($,J,K,Q,Z,z,B){let U=Q/4;return`<polygon points="${[`${$+U},${J}`,`${$+K-U},${J}`,`${$+K},${J+Q/2}`,`${$+K-U},${J+Q}`,`${$+U},${J+Q}`,`${$},${J+Q/2}`].join(" ")}" fill="${Z}" stroke="${z}" stroke-width="${B}" />`}function l8($,J,K,Q,Z,z,B){let j=$+K/2,_=J+7,F=Q-14;return`<rect x="${$}" y="${_}" width="${K}" height="${F}" fill="${Z}" stroke="none" />
<line x1="${$}" y1="${_}" x2="${$}" y2="${_+F}" stroke="${z}" stroke-width="${B}" />
<line x1="${$+K}" y1="${_}" x2="${$+K}" y2="${_+F}" stroke="${z}" stroke-width="${B}" />
<ellipse cx="${j}" cy="${J+Q-7}" rx="${K/2}" ry="7" fill="${Z}" stroke="${z}" stroke-width="${B}" />
<ellipse cx="${j}" cy="${_}" rx="${K/2}" ry="7" fill="${Z}" stroke="${z}" stroke-width="${B}" />`}function d8($,J,K,Q,Z,z,B){return`<polygon points="${[`${$+12},${J}`,`${$+K},${J}`,`${$+K},${J+Q}`,`${$+12},${J+Q}`,`${$},${J+Q/2}`].join(" ")}" fill="${Z}" stroke="${z}" stroke-width="${B}" />`}function n8($,J,K,Q,Z,z,B){let U=K*0.15;return`<polygon points="${[`${$+U},${J}`,`${$+K-U},${J}`,`${$+K},${J+Q}`,`${$},${J+Q}`].join(" ")}" fill="${Z}" stroke="${z}" stroke-width="${B}" />`}function g8($,J,K,Q,Z,z,B){let U=K*0.15;return`<polygon points="${[`${$},${J}`,`${$+K},${J}`,`${$+K-U},${J+Q}`,`${$+U},${J+Q}`].join(" ")}" fill="${Z}" stroke="${z}" stroke-width="${B}" />`}function o8($,J,K,Q){let Z=$+K/2,z=J+Q/2,B=Math.min(K,Q)/2-2;return`<circle cx="${Z}" cy="${z}" r="${B}" fill="var(--_text)" stroke="none" />`}function s8($,J,K,Q){let Z=$+K/2,z=J+Q/2,B=Math.min(K,Q)/2-2,U=B-4;return`<circle cx="${Z}" cy="${z}" r="${B}" fill="none" stroke="var(--_text)" stroke-width="${Z0.innerBox*2}" />
<circle cx="${Z}" cy="${z}" r="${U}" fill="var(--_text)" stroke="none" />`}function i8($,J){if($.shape==="state-start"||$.shape==="state-end"){if(!$.label)return""}let K=$.x+$.width/2,Q=$.y+$.height/2,Z=$.inlineStyle?.color??"var(--_text)";return`<text x="${K}" y="${Q}" text-anchor="middle" dy="${j0}" font-size="${r.nodeLabel}" font-weight="${K0.nodeLabel}" fill="${Z}">${F6($.label)}</text>`}function F6($){return $.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}var $0={padding:30,actorGap:140,actorHeight:40,actorPadX:16,headerGap:20,messageRowHeight:40,selfMessageHeight:30,activationWidth:10,blockPadX:10,blockPadTop:40,blockPadBottom:8,blockHeaderExtra:28,dividerExtra:24,noteWidth:120,notePadding:8,noteGap:10};function a8($,J={}){if($.actors.length===0)return{width:0,height:0,actors:[],lifelines:[],messages:[],activations:[],blocks:[],notes:[]};let K=$.actors.map((Y)=>{let A=_0(Y.label,r.nodeLabel,K0.nodeLabel);return Math.max(A+$0.actorPadX*2,80)}),Q=[],Z=$0.padding+K[0]/2;for(let Y=0;Y<$.actors.length;Y++){if(Y>0){let A=Math.max($0.actorGap,(K[Y-1]+K[Y])/2+40);Z+=A}Q.push(Z)}let z=new Map;for(let Y=0;Y<$.actors.length;Y++)z.set($.actors[Y].id,Y);let B=$0.padding,U=$.actors.map((Y,A)=>({id:Y.id,label:Y.label,type:Y.type,x:Q[A],y:B,width:K[A],height:$0.actorHeight})),j=B+$0.actorHeight+$0.headerGap,_=[],F=new Map;for(let Y of $.blocks){let A=F.get(Y.startIndex)??0;F.set(Y.startIndex,Math.max(A,$0.blockHeaderExtra));for(let O of Y.dividers){let k=F.get(O.index)??0;F.set(O.index,Math.max(k,$0.dividerExtra))}}let H=new Map,V=[];for(let Y=0;Y<$.messages.length;Y++){let A=$.messages[Y],O=z.get(A.from)??0,k=z.get(A.to)??0,v=A.from===A.to,u=F.get(Y)??0;if(u>0)j+=u;let b=Q[O],f=Q[k];if(_.push({from:A.from,to:A.to,label:A.label,lineStyle:A.lineStyle,arrowHead:A.arrowHead,x1:b,x2:f,y:j,isSelf:v}),A.activate){if(!H.has(A.to))H.set(A.to,[]);H.get(A.to).push(j)}if(A.deactivate){let X=H.get(A.from);if(X&&X.length>0){let C=X.pop(),w=z.get(A.from)??0;V.push({actorId:A.from,x:Q[w]-$0.activationWidth/2,topY:C,bottomY:j,width:$0.activationWidth})}}j+=v?$0.selfMessageHeight+$0.messageRowHeight:$0.messageRowHeight}for(let[Y,A]of H)for(let O of A){let k=z.get(Y)??0;V.push({actorId:Y,x:Q[k]-$0.activationWidth/2,topY:O,bottomY:j-$0.messageRowHeight/2,width:$0.activationWidth})}let P=$.blocks.map((Y)=>{let A=_[Y.startIndex],O=_[Y.endIndex],k=(A?.y??j)-$0.blockPadTop,v=(O?.y??j)+$0.blockPadBottom+12,u=new Set;for(let S=Y.startIndex;S<=Y.endIndex;S++){let L=$.messages[S];if(L)u.add(z.get(L.from)??0),u.add(z.get(L.to)??0)}if(u.size===0)for(let S=0;S<$.actors.length;S++)u.add(S);let b=Math.min(...u),f=Math.max(...u),X=Q[b]-K[b]/2-$0.blockPadX,C=Q[f]+K[f]/2+$0.blockPadX,w=Y.dividers.map((S)=>{let L=_[S.index],c=L?.y??j,s=28;if(S.label&&L?.label){let E=`[${S.label}]`,d=_0(E,r.edgeLabel,K0.edgeLabel),l=X+8,p=l+d,h=_0(L.label,r.edgeLabel,K0.edgeLabel),m=L.isSelf?L.x1+36:(L.x1+L.x2)/2-h/2,n=m+h;if(p>m&&l<n)s=36}return{y:c-s,label:S.label}});return{type:Y.type,label:Y.label,x:X,y:k,width:C-X,height:v-k,dividers:w}}),W=$.notes.map((Y)=>{let A=Math.max($0.noteWidth,_0(Y.text,r.edgeLabel,K0.edgeLabel)+$0.notePadding*2),O=r.edgeLabel+$0.notePadding*2,v=(_[Y.afterIndex]?.y??B+$0.actorHeight)+4,u=z.get(Y.actorIds[0]??"")??0,b;if(Y.position==="left")b=Q[u]-K[u]/2-A-$0.noteGap;else if(Y.position==="right")b=Q[u]+K[u]/2+$0.noteGap;else if(Y.actorIds.length>1){let f=z.get(Y.actorIds[Y.actorIds.length-1]??"")??u;b=(Q[u]+Q[f])/2-A/2}else b=Q[u]-A/2;return{text:Y.text,x:b,y:v,width:A,height:O}}),G=j+$0.padding,R=$0.padding,M=0;for(let Y of U)R=Math.min(R,Y.x-Y.width/2),M=Math.max(M,Y.x+Y.width/2);for(let Y of P)R=Math.min(R,Y.x),M=Math.max(M,Y.x+Y.width);for(let Y of W)R=Math.min(R,Y.x),M=Math.max(M,Y.x+Y.width);let q=R<$0.padding?$0.padding-R:0;if(q>0){for(let Y of U)Y.x+=q;for(let Y of _)Y.x1+=q,Y.x2+=q;for(let Y of V)Y.x+=q;for(let Y of P)Y.x+=q;for(let Y of W)Y.x+=q;for(let Y=0;Y<Q.length;Y++)Q[Y]+=q}let D=$.actors.map((Y,A)=>({actorId:Y.id,x:Q[A],topY:B+$0.actorHeight,bottomY:G-$0.padding})),I=M+q+$0.padding,x=G;return{width:Math.max(I,200),height:Math.max(x,100),actors:U,lifelines:D,messages:_,activations:V,blocks:P,notes:W}}function t8($,J,K="Inter",Q=!1){let Z=[];Z.push(e0($.width,$.height,J,Q)),Z.push(r0(K,!1)),Z.push("<defs>"),Z.push(r8()),Z.push("</defs>");for(let z of $.blocks)Z.push(K9(z));for(let z of $.lifelines)Z.push($9(z));for(let z of $.activations)Z.push(J9(z));for(let z of $.messages)Z.push(Q9(z));for(let z of $.notes)Z.push(Z9(z));for(let z of $.actors)Z.push(e8(z));return Z.push("</svg>"),Z.join(`
`)}function r8(){let{width:$,height:J}=n0;return`  <marker id="seq-arrow" markerWidth="${$}" markerHeight="${J}" refX="${$}" refY="${J/2}" orient="auto-start-reverse">
    <polygon points="0 0, ${$} ${J/2}, 0 ${J}" fill="var(--_arrow)" />
  </marker>
  <marker id="seq-arrow-open" markerWidth="${$}" markerHeight="${J}" refX="${$}" refY="${J/2}" orient="auto-start-reverse">
    <polyline points="0 0, ${$} ${J/2}, 0 ${J}" fill="none" stroke="var(--_arrow)" stroke-width="1" />
  </marker>`}function e8($){let{x:J,y:K,width:Q,height:Z,label:z,type:B}=$;if(B==="actor"){let j=Z/24*0.9,_=J-12*j,F=K+(Z-24*j)/2,H=Z0.outerBox/j,V="var(--_line)";return`<g transform="translate(${_},${F}) scale(${j})">
  <path d="M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z" fill="none" stroke="var(--_line)" stroke-width="${H}" />
  <path d="M15 10C15 11.6569 13.6569 13 12 13C10.3431 13 9 11.6569 9 10C9 8.34315 10.3431 7 12 7C13.6569 7 15 8.34315 15 10Z" fill="none" stroke="var(--_line)" stroke-width="${H}" />
  <path d="M5.62842 18.3563C7.08963 17.0398 9.39997 16 12 16C14.6 16 16.9104 17.0398 18.3716 18.3563" fill="none" stroke="var(--_line)" stroke-width="${H}" />
</g>
<text x="${J}" y="${K+Z+14}" text-anchor="middle" font-size="${r.nodeLabel}" font-weight="${K0.nodeLabel}" fill="var(--_text)">${T0(z)}</text>`}return`<rect x="${J-Q/2}" y="${K}" width="${Q}" height="${Z}" rx="4" ry="4" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="${Z0.outerBox}" />
<text x="${J}" y="${K+Z/2}" text-anchor="middle" dy="${j0}" font-size="${r.nodeLabel}" font-weight="${K0.nodeLabel}" fill="var(--_text)">${T0(z)}</text>`}function $9($){return`<line x1="${$.x}" y1="${$.topY}" x2="${$.x}" y2="${$.bottomY}" stroke="var(--_line)" stroke-width="0.75" stroke-dasharray="6 4" />`}function J9($){return`<rect x="${$.x}" y="${$.topY}" width="${$.width}" height="${$.bottomY-$.topY}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="${Z0.innerBox}" />`}function Q9($){let J=[],K=$.lineStyle==="dashed"?' stroke-dasharray="6 4"':"",Q=$.arrowHead==="filled"?"seq-arrow":"seq-arrow-open";if($.isSelf)J.push(`<polyline points="${$.x1},${$.y} ${$.x1+30},${$.y} ${$.x1+30},${$.y+20} ${$.x2},${$.y+20}" fill="none" stroke="var(--_line)" stroke-width="${Z0.connector}"${K} marker-end="url(#${Q})" />`),J.push(`<text x="${$.x1+30+6}" y="${$.y+10}" dy="${j0}" font-size="${r.edgeLabel}" font-weight="${K0.edgeLabel}" fill="var(--_text-muted)">${T0($.label)}</text>`);else{J.push(`<line x1="${$.x1}" y1="${$.y}" x2="${$.x2}" y2="${$.y}" stroke="var(--_line)" stroke-width="${Z0.connector}"${K} marker-end="url(#${Q})" />`);let Z=($.x1+$.x2)/2;J.push(`<text x="${Z}" y="${$.y-6}" text-anchor="middle" font-size="${r.edgeLabel}" font-weight="${K0.edgeLabel}" fill="var(--_text-muted)">${T0($.label)}</text>`)}return J.join(`
`)}function K9($){let J=[];J.push(`<rect x="${$.x}" y="${$.y}" width="${$.width}" height="${$.height}" rx="0" ry="0" fill="none" stroke="var(--_node-stroke)" stroke-width="${Z0.outerBox}" />`);let K=`${$.type}${$.label?` [${$.label}]`:""}`,Q=_0(K,r.edgeLabel,K0.groupHeader)+16,Z=18;J.push(`<rect x="${$.x}" y="${$.y}" width="${Q}" height="${Z}" fill="var(--_group-hdr)" stroke="var(--_node-stroke)" stroke-width="${Z0.outerBox}" />`),J.push(`<text x="${$.x+6}" y="${$.y+Z/2}" dy="${j0}" font-size="${r.edgeLabel}" font-weight="${K0.groupHeader}" fill="var(--_text-sec)">${T0(K)}</text>`);for(let z of $.dividers)if(J.push(`<line x1="${$.x}" y1="${z.y}" x2="${$.x+$.width}" y2="${z.y}" stroke="var(--_line)" stroke-width="0.75" stroke-dasharray="6 4" />`),z.label)J.push(`<text x="${$.x+8}" y="${z.y+14}" font-size="${r.edgeLabel}" font-weight="${K0.edgeLabel}" fill="var(--_text-muted)">[${T0(z.label)}]</text>`);return J.join(`
`)}function Z9($){return`<rect x="${$.x}" y="${$.y}" width="${$.width}" height="${$.height}" fill="var(--_group-hdr)" stroke="var(--_node-stroke)" stroke-width="${Z0.innerBox}" />
<polygon points="${$.x+$.width-6},${$.y} ${$.x+$.width},${$.y+6} ${$.x+$.width-6},${$.y+6}" fill="var(--_inner-stroke)" />
<text x="${$.x+$.width/2}" y="${$.y+$.height/2}" text-anchor="middle" dy="${j0}" font-size="${r.edgeLabel}" font-weight="${K0.edgeLabel}" fill="var(--_text-muted)">${T0($.text)}</text>`}function T0($){return $.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}var B0={padding:40,boxPadX:8,headerBaseHeight:32,annotationHeight:16,memberRowHeight:20,sectionPadY:8,emptySectionHeight:8,minWidth:120,memberFontSize:11,nodeSpacing:40,layerSpacing:60};async function U9($,J={}){if($.classes.length===0)return{width:0,height:0,classes:[],relationships:[]};let K=new Map;for(let U of $.classes){let j=U.annotation?B0.headerBaseHeight+B0.annotationHeight:B0.headerBaseHeight,_=U.attributes.length>0?U.attributes.length*B0.memberRowHeight+B0.sectionPadY:B0.emptySectionHeight,F=U.methods.length>0?U.methods.length*B0.memberRowHeight+B0.sectionPadY:B0.emptySectionHeight,H=_0(U.label,r.nodeLabel,K0.nodeLabel),V=b6(U.attributes),P=b6(U.methods),W=Math.max(B0.minWidth,H+B0.boxPadX*2,V+B0.boxPadX*2,P+B0.boxPadX*2),G=j+_+F;K.set(U.id,{width:W,height:G,headerHeight:j,attrHeight:_,methodHeight:F})}let Q=new Y0.default.graphlib.Graph({directed:!0});Q.setGraph({rankdir:"TB",acyclicer:"greedy",nodesep:B0.nodeSpacing,ranksep:B0.layerSpacing,marginx:B0.padding,marginy:B0.padding}),Q.setDefaultEdgeLabel(()=>({}));for(let U of $.classes){let j=K.get(U.id);Q.setNode(U.id,{width:j.width,height:j.height})}for(let U=0;U<$.relationships.length;U++){let j=$.relationships[U],_={_index:U};if(j.label)_.label=j.label,_.width=_0(j.label,r.edgeLabel,K0.edgeLabel)+8,_.height=r.edgeLabel+6,_.labelpos="c";Q.setEdge(j.from,j.to,_)}try{Y0.default.layout(Q)}catch(U){let j=U instanceof Error?U.message:String(U);throw Error(`Dagre layout failed (class diagram): ${j}`)}let Z=new Map;for(let U of $.classes)Z.set(U.id,U);let z=$.classes.map((U)=>{let j=Q.node(U.id),_=K.get(U.id),F=k0(j.x,j.y,j.width,j.height);return{id:U.id,label:U.label,annotation:U.annotation,attributes:U.attributes,methods:U.methods,x:F.x,y:F.y,width:j.width??_.width,height:j.height??_.height,headerHeight:_.headerHeight,attrHeight:_.attrHeight,methodHeight:_.methodHeight}}),B=Q.edges().map((U)=>{let j=Q.edge(U),_=$.relationships[j._index],F=j.points??[],H=h0(F,!0),V=Q.node(U.v),P=Q.node(U.w),W=J6(H,V?{cx:V.x,cy:V.y,hw:V.width/2,hh:V.height/2}:null,P?{cx:P.x,cy:P.y,hw:P.width/2,hh:P.height/2}:null),G;if(_.label&&j.x!=null&&j.y!=null)G={x:j.x,y:j.y};return{from:_.from,to:_.to,type:_.type,markerAt:_.markerAt,label:_.label,fromCardinality:_.fromCardinality,toCardinality:_.toCardinality,points:W,labelPosition:G}});return{width:Q.graph().width??600,height:Q.graph().height??400,classes:z,relationships:B}}function b6($){if($.length===0)return 0;let J=0;for(let K of $){let Q=V9(K),Z=s6(Q,B0.memberFontSize);if(Z>J)J=Z}return J}function V9($){let J=$.visibility?`${$.visibility} `:"",K=$.type?`: ${$.type}`:"";return`${J}${$.name}${K}`}var a0={memberSize:11,memberWeight:400,annotationSize:10,annotationWeight:500};function z9($,J,K="Inter",Q=!1){let Z=[];Z.push(e0($.width,$.height,J,Q)),Z.push(r0(K,!0)),Z.push("<defs>"),Z.push(B9()),Z.push("</defs>");for(let z of $.relationships)Z.push(_9(z));for(let z of $.classes)Z.push(j9(z));for(let z of $.relationships)Z.push(P9(z));return Z.push("</svg>"),Z.join(`
`)}function B9(){return`  <marker id="cls-inherit" markerWidth="12" markerHeight="10" refX="12" refY="5" orient="auto-start-reverse">
    <polygon points="0 0, 12 5, 0 10" fill="var(--bg)" stroke="var(--_arrow)" stroke-width="1.5" />
  </marker>
  <marker id="cls-composition" markerWidth="12" markerHeight="10" refX="0" refY="5" orient="auto-start-reverse">
    <polygon points="6 0, 12 5, 6 10, 0 5" fill="var(--_arrow)" stroke="var(--_arrow)" stroke-width="1" />
  </marker>
  <marker id="cls-aggregation" markerWidth="12" markerHeight="10" refX="0" refY="5" orient="auto-start-reverse">
    <polygon points="6 0, 12 5, 6 10, 0 5" fill="var(--bg)" stroke="var(--_arrow)" stroke-width="1.5" />
  </marker>
  <marker id="cls-arrow" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto-start-reverse">
    <polyline points="0 0, 8 3, 0 6" fill="none" stroke="var(--_arrow)" stroke-width="1.5" />
  </marker>`}function j9($){let{x:J,y:K,width:Q,height:Z,headerHeight:z,attrHeight:B,methodHeight:U}=$,j=[];j.push(`<rect x="${J}" y="${K}" width="${Q}" height="${Z}" rx="0" ry="0" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="${Z0.outerBox}" />`),j.push(`<rect x="${J}" y="${K}" width="${Q}" height="${z}" rx="0" ry="0" fill="var(--_group-hdr)" stroke="var(--_node-stroke)" stroke-width="${Z0.outerBox}" />`);let _=K+z/2;if($.annotation){let P=K+12;j.push(`<text x="${J+Q/2}" y="${P}" text-anchor="middle" dy="${j0}" font-size="${a0.annotationSize}" font-weight="${a0.annotationWeight}" font-style="italic" fill="var(--_text-muted)">&lt;&lt;${X0($.annotation)}&gt;&gt;</text>`),_=K+z/2+6}j.push(`<text x="${J+Q/2}" y="${_}" text-anchor="middle" dy="${j0}" font-size="${r.nodeLabel}" font-weight="700" fill="var(--_text)">${X0($.label)}</text>`);let F=K+z;j.push(`<line x1="${J}" y1="${F}" x2="${J+Q}" y2="${F}" stroke="var(--_node-stroke)" stroke-width="${Z0.innerBox}" />`);let H=20;for(let P=0;P<$.attributes.length;P++){let W=$.attributes[P],G=F+4+P*H+H/2;j.push(y6(W,J+B0.boxPadX,G))}let V=F+B;j.push(`<line x1="${J}" y1="${V}" x2="${J+Q}" y2="${V}" stroke="var(--_node-stroke)" stroke-width="${Z0.innerBox}" />`);for(let P=0;P<$.methods.length;P++){let W=$.methods[P],G=V+4+P*H+H/2;j.push(y6(W,J+B0.boxPadX,G))}return j.join(`
`)}function y6($,J,K){let Q=$.isAbstract?' font-style="italic"':"",Z=$.isStatic?' text-decoration="underline"':"",z=[];if($.visibility)z.push(`<tspan fill="var(--_text-faint)">${X0($.visibility)} </tspan>`);if(z.push(`<tspan fill="var(--_text-sec)">${X0($.name)}</tspan>`),$.type)z.push('<tspan fill="var(--_text-faint)">: </tspan>'),z.push(`<tspan fill="var(--_text-muted)">${X0($.type)}</tspan>`);return`<text x="${J}" y="${K}" class="mono" dy="${j0}" font-size="${a0.memberSize}" font-weight="${a0.memberWeight}"${Q}${Z}>${z.join("")}</text>`}function _9($){if($.points.length<2)return"";let J=$.points.map((z)=>`${z.x},${z.y}`).join(" "),Q=$.type==="dependency"||$.type==="realization"?' stroke-dasharray="6 4"':"",Z=G9($.type,$.markerAt);return`<polyline points="${J}" fill="none" stroke="var(--_line)" stroke-width="${Z0.connector}"${Q}${Z} />`}function G9($,J){let K=F9($);if(!K)return"";if(J==="from")return` marker-start="url(#${K})"`;else return` marker-end="url(#${K})"`}function F9($){switch($){case"inheritance":case"realization":return"cls-inherit";case"composition":return"cls-composition";case"aggregation":return"cls-aggregation";case"association":case"dependency":return"cls-arrow";default:return null}}function P9($){if(!$.label&&!$.fromCardinality&&!$.toCardinality)return"";if($.points.length<2)return"";let J=[];if($.label){let K=$.labelPosition??H9($.points);J.push(`<text x="${K.x}" y="${K.y-8}" text-anchor="middle" font-size="${r.edgeLabel}" font-weight="${K0.edgeLabel}" fill="var(--_text-muted)">${X0($.label)}</text>`)}if($.fromCardinality){let K=$.points[0],Q=$.points[1],Z=x6(K,Q);J.push(`<text x="${K.x+Z.x}" y="${K.y+Z.y}" text-anchor="middle" font-size="${r.edgeLabel}" font-weight="${K0.edgeLabel}" fill="var(--_text-muted)">${X0($.fromCardinality)}</text>`)}if($.toCardinality){let K=$.points[$.points.length-1],Q=$.points[$.points.length-2],Z=x6(K,Q);J.push(`<text x="${K.x+Z.x}" y="${K.y+Z.y}" text-anchor="middle" font-size="${r.edgeLabel}" font-weight="${K0.edgeLabel}" fill="var(--_text-muted)">${X0($.toCardinality)}</text>`)}return J.join(`
`)}function H9($){if($.length===0)return{x:0,y:0};let J=Math.floor($.length/2);return $[J]}function x6($,J){let K=J.x-$.x,Q=J.y-$.y;if(Math.abs(K)>Math.abs(Q))return{x:K>0?14:-14,y:-10};return{x:-14,y:Q>0?14:-14}}function X0($){return $.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}var W0={padding:40,boxPadX:12,headerHeight:32,rowHeight:22,minWidth:140,attrFontSize:11,nodeSpacing:50,layerSpacing:70};async function W9($,J={}){if($.entities.length===0)return{width:0,height:0,entities:[],relationships:[]};let K=new Map;for(let U of $.entities){let j=_0(U.label,r.nodeLabel,K0.nodeLabel),_=0;for(let V of U.attributes){let P=`${V.type}  ${V.name}${V.keys.length>0?"  "+V.keys.join(","):""}`,W=s6(P,W0.attrFontSize);if(W>_)_=W}let F=Math.max(W0.minWidth,j+W0.boxPadX*2,_+W0.boxPadX*2),H=W0.headerHeight+Math.max(U.attributes.length,1)*W0.rowHeight;K.set(U.id,{width:F,height:H})}let Q=new Y0.default.graphlib.Graph({directed:!0});Q.setGraph({rankdir:"LR",acyclicer:"greedy",nodesep:W0.nodeSpacing,ranksep:W0.layerSpacing,marginx:W0.padding,marginy:W0.padding}),Q.setDefaultEdgeLabel(()=>({}));for(let U of $.entities){let j=K.get(U.id);Q.setNode(U.id,{width:j.width,height:j.height})}for(let U=0;U<$.relationships.length;U++){let j=$.relationships[U];Q.setEdge(j.entity1,j.entity2,{_index:U,label:j.label,width:_0(j.label,r.edgeLabel,K0.edgeLabel)+8,height:r.edgeLabel+6,labelpos:"c"})}try{Y0.default.layout(Q)}catch(U){let j=U instanceof Error?U.message:String(U);throw Error(`Dagre layout failed (ER diagram): ${j}`)}let Z=new Map;for(let U of $.entities)Z.set(U.id,U);let z=$.entities.map((U)=>{let j=Q.node(U.id),_=k0(j.x,j.y,j.width,j.height);return{id:U.id,label:U.label,attributes:U.attributes,x:_.x,y:_.y,width:j.width??K.get(U.id).width,height:j.height??K.get(U.id).height,headerHeight:W0.headerHeight,rowHeight:W0.rowHeight}}),B=Q.edges().map((U)=>{let j=Q.edge(U),_=$.relationships[j._index],F=j.points??[],H=h0(F,!1),V=Q.node(U.v),P=Q.node(U.w),W=J6(H,V?{cx:V.x,cy:V.y,hw:V.width/2,hh:V.height/2}:null,P?{cx:P.x,cy:P.y,hw:P.width/2,hh:P.height/2}:null);return{entity1:_.entity1,entity2:_.entity2,cardinality1:_.cardinality1,cardinality2:_.cardinality2,label:_.label,identifying:_.identifying,points:W}});return{width:Q.graph().width??600,height:Q.graph().height??400,entities:z,relationships:B}}var R0={attrSize:11,attrWeight:400,keySize:9,keyWeight:600};function M9($,J,K="Inter",Q=!1){let Z=[];Z.push(e0($.width,$.height,J,Q)),Z.push(r0(K,!0)),Z.push("<defs>"),Z.push("</defs>");for(let z of $.relationships)Z.push(Y9(z));for(let z of $.entities)Z.push(R9(z));for(let z of $.relationships)Z.push(O9(z));for(let z of $.relationships)Z.push(A9(z));return Z.push("</svg>"),Z.join(`
`)}function R9($){let{x:J,y:K,width:Q,height:Z,headerHeight:z,rowHeight:B,label:U,attributes:j}=$,_=[];_.push(`<rect x="${J}" y="${K}" width="${Q}" height="${Z}" rx="0" ry="0" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="${Z0.outerBox}" />`),_.push(`<rect x="${J}" y="${K}" width="${Q}" height="${z}" rx="0" ry="0" fill="var(--_group-hdr)" stroke="var(--_node-stroke)" stroke-width="${Z0.outerBox}" />`),_.push(`<text x="${J+Q/2}" y="${K+z/2}" text-anchor="middle" dy="${j0}" font-size="${r.nodeLabel}" font-weight="700" fill="var(--_text)">${t0(U)}</text>`);let F=K+z;_.push(`<line x1="${J}" y1="${F}" x2="${J+Q}" y2="${F}" stroke="var(--_node-stroke)" stroke-width="${Z0.innerBox}" />`);for(let H=0;H<j.length;H++){let V=j[H],P=F+H*B+B/2;_.push(q9(V,J,P,Q))}if(j.length===0)_.push(`<text x="${J+Q/2}" y="${F+B/2}" text-anchor="middle" dy="${j0}" font-size="${R0.attrSize}" fill="var(--_text-faint)" font-style="italic">(no attributes)</text>`);return _.join(`
`)}function q9($,J,K,Q){let Z=[],z=0;if($.keys.length>0){let j=$.keys.join(",");z=_0(j,R0.keySize,R0.keyWeight)+8,Z.push(`<rect x="${J+6}" y="${K-7}" width="${z}" height="14" rx="2" ry="2" fill="var(--_key-badge)" />`),Z.push(`<text x="${J+6+z/2}" y="${K}" text-anchor="middle" dy="${j0}" font-size="${R0.keySize}" font-weight="${R0.keyWeight}" fill="var(--_text-sec)">${$.keys.join(",")}</text>`)}let B=J+8+(z>0?z+6:0);Z.push(`<text x="${B}" y="${K}" class="mono" dy="${j0}" font-size="${R0.attrSize}" font-weight="${R0.attrWeight}"><tspan fill="var(--_text-muted)">${t0($.type)}</tspan></text>`);let U=J+Q-8;return Z.push(`<text x="${U}" y="${K}" class="mono" text-anchor="end" dy="${j0}" font-size="${R0.attrSize}" font-weight="${R0.attrWeight}"><tspan fill="var(--_text-sec)">${t0($.name)}</tspan></text>`),Z.join(`
`)}function Y9($){if($.points.length<2)return"";let J=$.points.map((Q)=>`${Q.x},${Q.y}`).join(" "),K=!$.identifying?' stroke-dasharray="6 4"':"";return`<polyline points="${J}" fill="none" stroke="var(--_line)" stroke-width="${Z0.connector}"${K} />`}function A9($){if(!$.label||$.points.length<2)return"";let J=X9($.points),Q=_0($.label,r.edgeLabel,K0.edgeLabel)+8,Z=r.edgeLabel+6;return`<rect x="${J.x-Q/2}" y="${J.y-Z/2}" width="${Q}" height="${Z}" rx="2" ry="2" fill="var(--bg)" stroke="var(--_inner-stroke)" stroke-width="0.5" />
<text x="${J.x}" y="${J.y}" text-anchor="middle" dy="${j0}" font-size="${r.edgeLabel}" font-weight="${K0.edgeLabel}" fill="var(--_text-muted)">${t0($.label)}</text>`}function O9($){if($.points.length<2)return"";let J=[],K=$.points[0],Q=$.points[1];J.push(v6(K,Q,$.cardinality1));let Z=$.points[$.points.length-1],z=$.points[$.points.length-2];return J.push(v6(Z,z,$.cardinality2)),J.join(`
`)}function v6($,J,K){let Q=[],Z=Z0.connector+0.25,z=$.x-J.x,B=$.y-J.y,U=Math.sqrt(z*z+B*B);if(U===0)return"";let j=z/U,_=B/U,F=-_,H=j,V=$.x-j*4,P=$.y-_*4,W=$.x-j*16,G=$.y-_*16,R=K==="one"||K==="zero-one",M=K==="many"||K==="zero-many",q=K==="zero-one"||K==="zero-many";if(R){Q.push(`<line x1="${V+F*6}" y1="${P+H*6}" x2="${V-F*6}" y2="${P-H*6}" stroke="var(--_line)" stroke-width="${Z}" />`);let I=V-j*4,x=P-_*4;Q.push(`<line x1="${I+F*6}" y1="${x+H*6}" x2="${I-F*6}" y2="${x-H*6}" stroke="var(--_line)" stroke-width="${Z}" />`)}if(M){let I=V,x=P;Q.push(`<line x1="${I+F*7}" y1="${x+H*7}" x2="${W}" y2="${G}" stroke="var(--_line)" stroke-width="${Z}" />`),Q.push(`<line x1="${I}" y1="${x}" x2="${W}" y2="${G}" stroke="var(--_line)" stroke-width="${Z}" />`),Q.push(`<line x1="${I-F*7}" y1="${x-H*7}" x2="${W}" y2="${G}" stroke="var(--_line)" stroke-width="${Z}" />`)}if(q){let D=M?20:12,I=$.x-j*D,x=$.y-_*D;Q.push(`<circle cx="${I}" cy="${x}" r="4" fill="var(--bg)" stroke="var(--_line)" stroke-width="${Z}" />`)}return Q.join(`
`)}function X9($){if($.length===0)return{x:0,y:0};if($.length===1)return $[0];let J=0;for(let Z=1;Z<$.length;Z++){let z=$[Z].x-$[Z-1].x,B=$[Z].y-$[Z-1].y;J+=Math.sqrt(z*z+B*B)}if(J===0)return $[0];let K=J/2,Q=0;for(let Z=1;Z<$.length;Z++){let z=$[Z].x-$[Z-1].x,B=$[Z].y-$[Z-1].y,U=Math.sqrt(z*z+B*B);if(Q+U>=K){let j=U>0?(K-Q)/U:0;return{x:$[Z-1].x+z*j,y:$[Z-1].y+B*j}}Q+=U}return $[$.length-1]}function t0($){return $.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function D9($){let J=$.trim().split(`
`)[0]?.trim().toLowerCase()??"";if(/^sequencediagram\s*$/.test(J))return"sequence";if(/^classdiagram\s*$/.test(J))return"class";if(/^erdiagram\s*$/.test(J))return"er";return"flowchart"}function C9($){return{bg:$.bg??A6.bg,fg:$.fg??A6.fg,line:$.line,accent:$.accent,muted:$.muted,surface:$.surface,border:$.border}}async function K7($,J={}){let K=C9(J),Q=J.font??"Inter",Z=J.transparent??!1,z=D9($),B=$.split(`
`).map((U)=>U.trim()).filter((U)=>U.length>0&&!U.startsWith("%%"));switch(z){case"sequence":{let U=d6(B),j=a8(U,J);return t8(j,K,Q,Z)}case"class":{let U=n6(B),j=await U9(U,J);return z9(j,K,Q,Z)}case"er":{let U=g6(B),j=await W9(U,J);return M9(j,K,Q,Z)}case"flowchart":default:{let U=u6($),j=await I8(U,J);return E8(j,K,Q,Z)}}}
